<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Command.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPNJREFUeNpi/P//PwMlgOXHUjly9E0G4hwgZmQiQZMqEK8H4v9QzUEgQSaoADK+zhH9iAGL+C0gDoAaNg9mGLoLfgA1awK9hS9gzgJxA9RQBmQDrgMxJzRMGKE4HYj/Ial5A8QmQLwCJoBsgBYW2+TR1ChDaWt4LOBxKsi/VUh8XiD+gq4IVyzwQAMJBoKwacZlAB8Qf0bi96IZhtOAe1D6LpqaEiz6rmEzQAeIzwGxCJpieFqApo/vQKyJboAaEBsAsSEupwI1MwKjGBTVHOhegMX5UajYRqiBjMgYmj400cVh0XgTiKdC0zhJgJHS7AwQYABm9EAdCKrEfAAAAABJRU5ErkJggg=="/>
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-comment">//! Container Argument for Sub Commands, Options, and Values.</span></span>
<span class="line" id="L2"><span class="tok-comment">//!</span></span>
<span class="line" id="L3"><span class="tok-comment">//! A Command may contain any mix of those Arguments or none at all if it's to be used as a standalone Command.</span></span>
<span class="line" id="L4"><span class="tok-comment">//!</span></span>
<span class="line" id="L5"><span class="tok-comment">//! End User Example:</span></span>
<span class="line" id="L6"><span class="tok-comment">//!</span></span>
<span class="line" id="L7"><span class="tok-comment">//! ```</span></span>
<span class="line" id="L8"><span class="tok-comment">//! # Standalone Command</span></span>
<span class="line" id="L9"><span class="tok-comment">//! myapp help</span></span>
<span class="line" id="L10"><span class="tok-comment">//!</span></span>
<span class="line" id="L11"><span class="tok-comment">//! # Command w/ Options and Values</span></span>
<span class="line" id="L12"><span class="tok-comment">//! myapp -d &quot;This Value belongs to the 'd' Option.&quot; --toggle &quot;This is a standalone Value.&quot;</span></span>
<span class="line" id="L13"><span class="tok-comment">//! </span></span>
<span class="line" id="L14"><span class="tok-comment">//! # Command w/ Sub Command</span></span>
<span class="line" id="L15"><span class="tok-comment">//! myapp --opt &quot;Option for 'myapp' Command.&quot; subcmd --subcmd_opt &quot;Option for 'subcmd' Sub Command.&quot;</span></span>
<span class="line" id="L16"><span class="tok-comment">//! ```</span></span>
<span class="line" id="L17"></span>
<span class="line" id="L18"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L19"><span class="tok-kw">const</span> ascii = std.ascii;</span>
<span class="line" id="L20"><span class="tok-kw">const</span> builtin = std.builtin;</span>
<span class="line" id="L21"><span class="tok-kw">const</span> fmt = std.fmt;</span>
<span class="line" id="L22"><span class="tok-kw">const</span> log = std.log;</span>
<span class="line" id="L23"><span class="tok-kw">const</span> mem = std.mem;</span>
<span class="line" id="L24"><span class="tok-kw">const</span> meta = std.meta;</span>
<span class="line" id="L25"><span class="tok-kw">const</span> ComptimeStringMap = std.ComptimeStringMap;</span>
<span class="line" id="L26"><span class="tok-kw">const</span> StringHashMap = std.StringHashMap;</span>
<span class="line" id="L27"></span>
<span class="line" id="L28"><span class="tok-kw">const</span> toLower = ascii.toLower;</span>
<span class="line" id="L29"><span class="tok-kw">const</span> toUpper = ascii.toUpper;</span>
<span class="line" id="L30"></span>
<span class="line" id="L31"><span class="tok-kw">const</span> Option = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;Option.zig&quot;</span>);</span>
<span class="line" id="L32"><span class="tok-kw">const</span> Value = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;Value.zig&quot;</span>);</span>
<span class="line" id="L33"><span class="tok-kw">const</span> utils = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;utils.zig&quot;</span>);</span>
<span class="line" id="L34"><span class="tok-kw">const</span> indexOfEql = utils.indexOfEql;</span>
<span class="line" id="L35"></span>
<span class="line" id="L36"></span>
<span class="line" id="L37"><span class="tok-comment">/// Config for custom Command types. </span></span>
<span class="line" id="L38"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> Config = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L39">    <span class="tok-comment">/// Option Config for this Command type.</span></span>
<span class="line" id="L40">    opt_config: Option.Config = .{},</span>
<span class="line" id="L41">    <span class="tok-comment">/// Value Config for this Command type.</span></span>
<span class="line" id="L42">    val_config: Value.Config = .{},</span>
<span class="line" id="L43"></span>
<span class="line" id="L44">    <span class="tok-comment">/// Sub Commands Help Format.</span></span>
<span class="line" id="L45">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L46">    <span class="tok-comment">/// 1. String (Command Name)</span></span>
<span class="line" id="L47">    <span class="tok-comment">/// 2. String (Command Description)</span></span>
<span class="line" id="L48">    subcmds_help_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;{s}: {s}&quot;</span>,</span>
<span class="line" id="L49">    <span class="tok-comment">/// Values Help Format.</span></span>
<span class="line" id="L50">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L51">    <span class="tok-comment">/// 1. String (Value Name)</span></span>
<span class="line" id="L52">    <span class="tok-comment">/// 2. String (Value Type)</span></span>
<span class="line" id="L53">    <span class="tok-comment">/// 3. String (Value Description)</span></span>
<span class="line" id="L54">    vals_help_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;{s} ({s}): {s}&quot;</span>,</span>
<span class="line" id="L55">    <span class="tok-comment">/// Sub Commands Usage Format.</span></span>
<span class="line" id="L56">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L57">    <span class="tok-comment">/// 1. String (Command Name)</span></span>
<span class="line" id="L58">    subcmds_usage_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> =<span class="tok-str">&quot;'{s}'&quot;</span>, </span>
<span class="line" id="L59">    <span class="tok-comment">/// Values Usage Format.</span></span>
<span class="line" id="L60">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L61">    <span class="tok-comment">/// 1. String (Value Name)</span></span>
<span class="line" id="L62">    <span class="tok-comment">/// 2. String (Value Type)</span></span>
<span class="line" id="L63">    vals_usage_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;\&quot;{s} ({s})\&quot;&quot;</span>,</span>
<span class="line" id="L64"></span>
<span class="line" id="L65">    <span class="tok-comment">/// The Global Help Prefix for all instances of this Command type.</span></span>
<span class="line" id="L66">    <span class="tok-comment">/// This can be overwritten per instance using the `help_prefix` field. </span></span>
<span class="line" id="L67">    global_help_prefix: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L68"></span>
<span class="line" id="L69">    <span class="tok-comment">/// The Default Max Number of Arguments for Commands, Options, and Values individually.</span></span>
<span class="line" id="L70">    <span class="tok-comment">/// This is used in for both `init()` and `from()` but can be overwritten for the latter.</span></span>
<span class="line" id="L71">    max_args: <span class="tok-type">u8</span> = <span class="tok-number">25</span>, </span>
<span class="line" id="L72"></span>
<span class="line" id="L73">    <span class="tok-comment">/// During parsing, mandate that a Sub Command be used with a Command if one is available.</span></span>
<span class="line" id="L74">    <span class="tok-comment">/// This will not include Usage/Help Commands.</span></span>
<span class="line" id="L75">    <span class="tok-comment">/// This can be overwritten on individual Commands using the `Command.Custom.sub_cmds_mandatory` field.</span></span>
<span class="line" id="L76">    sub_cmds_mandatory: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L77">    <span class="tok-comment">/// During parsing, mandate that all Values for a Command must be filled, otherwise error out.</span></span>
<span class="line" id="L78">    <span class="tok-comment">/// This should generally be set to `true`. Prefer to use Options over Values for Arguments that are not mandatory.</span></span>
<span class="line" id="L79">    <span class="tok-comment">/// This can be overwritten on individual Commands using the `Command.Custom.vals_mandatory` field.</span></span>
<span class="line" id="L80">    vals_mandatory: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L81">};</span>
<span class="line" id="L82"></span>
<span class="line" id="L83"><span class="tok-comment">/// Create a Command type with the Base (default) configuration.</span></span>
<span class="line" id="L84"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">Base</span>() <span class="tok-type">type</span> { <span class="tok-kw">return</span> Custom(.{}); }</span>
<span class="line" id="L85"></span>
<span class="line" id="L86"><span class="tok-comment">/// Create a Custom Command type from the provided Config (`config`).</span></span>
<span class="line" id="L87"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">Custom</span>(<span class="tok-kw">comptime</span> config: Config) <span class="tok-type">type</span> {</span>
<span class="line" id="L88">    <span class="tok-kw">return</span> <span class="tok-kw">struct</span> {</span>
<span class="line" id="L89">        <span class="tok-comment">/// The Custom Option type to be used by this Custom Command type.</span></span>
<span class="line" id="L90">        <span class="tok-kw">const</span> opt_config = optConfig: {</span>
<span class="line" id="L91">            <span class="tok-kw">var</span> val_opt_config = config.opt_config;</span>
<span class="line" id="L92">            val_opt_config.val_config = config.val_config;</span>
<span class="line" id="L93">            <span class="tok-kw">break</span> :optConfig val_opt_config;</span>
<span class="line" id="L94">        };</span>
<span class="line" id="L95">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> OptionT = Option.Custom(opt_config);</span>
<span class="line" id="L96">        <span class="tok-comment">/// The Custom Value type to be used by this Custom Command type.</span></span>
<span class="line" id="L97">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> ValueT = Value.Custom(config.val_config);</span>
<span class="line" id="L98"></span>
<span class="line" id="L99">        <span class="tok-comment">/// Sub Commands Help Format.</span></span>
<span class="line" id="L100">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L101">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> subcmds_help_fmt = config.subcmds_help_fmt;</span>
<span class="line" id="L102">        <span class="tok-comment">/// Values Help Format.</span></span>
<span class="line" id="L103">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L104">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> vals_help_fmt = config.vals_help_fmt;</span>
<span class="line" id="L105">        <span class="tok-comment">/// Sub Commands Usage Format.</span></span>
<span class="line" id="L106">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L107">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> subcmds_usage_fmt = config.subcmds_usage_fmt;</span>
<span class="line" id="L108">        <span class="tok-comment">/// Values Usage Format.</span></span>
<span class="line" id="L109">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L110">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> vals_usage_fmt = config.vals_usage_fmt;</span>
<span class="line" id="L111">        <span class="tok-comment">/// Global Help Prefix.</span></span>
<span class="line" id="L112">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L113">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> global_help_prefix = config.global_help_prefix;</span>
<span class="line" id="L114">        <span class="tok-comment">/// Max Args.</span></span>
<span class="line" id="L115">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L116">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> max_args = config.max_args;</span>
<span class="line" id="L117"></span>
<span class="line" id="L118">        <span class="tok-comment">/// Flag denoting if this Command has been initialized to memory using `init()`.</span></span>
<span class="line" id="L119">        <span class="tok-comment">///</span></span>
<span class="line" id="L120">        <span class="tok-comment">/// **Internal Use.**</span></span>
<span class="line" id="L121">        _is_init: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L122">        <span class="tok-comment">/// The Allocator for this Command.</span></span>
<span class="line" id="L123">        <span class="tok-comment">/// This is set using `init()`.</span></span>
<span class="line" id="L124">        <span class="tok-comment">///</span></span>
<span class="line" id="L125">        <span class="tok-comment">/// **Internal Use.**</span></span>
<span class="line" id="L126">        _alloc: ?mem.Allocator = <span class="tok-null">null</span>,</span>
<span class="line" id="L127"></span>
<span class="line" id="L128">        <span class="tok-comment">/// The list of Sub Commands this Command can take.</span></span>
<span class="line" id="L129">        sub_cmds: ?[]<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>() = <span class="tok-null">null</span>,</span>
<span class="line" id="L130">        <span class="tok-comment">/// The Sub Command assigned to this Command during Parsing, if any.</span></span>
<span class="line" id="L131">        <span class="tok-comment">///</span></span>
<span class="line" id="L132">        <span class="tok-comment">/// *This should be Read-Only for library users.*</span></span>
<span class="line" id="L133">        sub_cmd: ?*<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>() = <span class="tok-null">null</span>,</span>
<span class="line" id="L134"></span>
<span class="line" id="L135">        <span class="tok-comment">/// The list of Options this Command can take.</span></span>
<span class="line" id="L136">        opts: ?[]<span class="tok-kw">const</span> OptionT = <span class="tok-null">null</span>,</span>
<span class="line" id="L137">        <span class="tok-comment">/// The list of Values this Command can take.</span></span>
<span class="line" id="L138">        vals: ?[]<span class="tok-kw">const</span> ValueT = <span class="tok-null">null</span>,</span>
<span class="line" id="L139"></span>
<span class="line" id="L140">        <span class="tok-comment">/// The Name of this Command for user identification and Usage/Help messages.</span></span>
<span class="line" id="L141">        name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L142">        <span class="tok-comment">/// The Prefix message used immediately before a Usage/Help message is displayed.</span></span>
<span class="line" id="L143">        help_prefix: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = global_help_prefix,</span>
<span class="line" id="L144">        <span class="tok-comment">/// The Description of this Command for Usage/Help messages.</span></span>
<span class="line" id="L145">        description: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L146"></span>
<span class="line" id="L147">        <span class="tok-comment">/// During parsing, mandate that a Sub Command be used with this Command if one is available.</span></span>
<span class="line" id="L148">        <span class="tok-comment">/// Note, this will not include Usage/Help Commands.</span></span>
<span class="line" id="L149">        sub_cmds_mandatory: <span class="tok-type">bool</span> = config.sub_cmds_mandatory,</span>
<span class="line" id="L150">        <span class="tok-comment">/// During parsing, mandate that all Values for this Command must be filled, otherwise error out.</span></span>
<span class="line" id="L151">        <span class="tok-comment">/// This should generally be set to `true`. Prefer to use Options over Values for Arguments that are not mandatory.</span></span>
<span class="line" id="L152">        vals_mandatory: <span class="tok-type">bool</span> = config.vals_mandatory,</span>
<span class="line" id="L153"></span>
<span class="line" id="L154">        <span class="tok-comment">/// Sets the active Sub Command for this Command.</span></span>
<span class="line" id="L155">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setSubCmd</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), set_cmd: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) <span class="tok-type">void</span> {</span>
<span class="line" id="L156">            <span class="tok-builtin">@constCast</span>(self).*.sub_cmd = set_cmd;</span>
<span class="line" id="L157">        }</span>
<span class="line" id="L158">        <span class="tok-comment">/// Gets a reference to the Sub Command of this Command that matches the provided Name (`cmd_name`).</span></span>
<span class="line" id="L159">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getSubCmd</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), cmd_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) ?*<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L160">            <span class="tok-kw">if</span> (self.sub_cmds == <span class="tok-null">null</span>) <span class="tok-kw">return</span> <span class="tok-null">null</span>;</span>
<span class="line" id="L161">            <span class="tok-kw">for</span> (self.sub_cmds.?[<span class="tok-number">0</span>..]) |*cmd| <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, cmd.name, cmd_name)) <span class="tok-kw">return</span> cmd;</span>
<span class="line" id="L162">            <span class="tok-kw">return</span> <span class="tok-null">null</span>;</span>
<span class="line" id="L163">        }</span>
<span class="line" id="L164">        <span class="tok-comment">/// Check if the active Sub Command of this Command has the provided Name (`cmd_name`).</span></span>
<span class="line" id="L165">        <span class="tok-comment">/// This is useful for analyzing Commands that DO NOT have Sub Commands that need to be subsequently analyzed.</span></span>
<span class="line" id="L166">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">checkSubCmd</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), cmd_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L167">            <span class="tok-kw">return</span> <span class="tok-kw">if</span> (self.sub_cmd) |cmd| mem.eql(<span class="tok-type">u8</span>, cmd.name, cmd_name) <span class="tok-kw">else</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L168">        }</span>
<span class="line" id="L169">        <span class="tok-comment">/// Returns the active Sub Command of this Command if it matches the provided Name (`cmd_name`). </span></span>
<span class="line" id="L170">        <span class="tok-comment">/// This is useful for analyzing Commands that DO have Sub Commands that need to be subsequently analyzed.</span></span>
<span class="line" id="L171">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">matchSubCmd</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), cmd_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) ?*<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L172">            <span class="tok-kw">return</span> <span class="tok-kw">if</span> (self.checkSubCmd(cmd_name)) self.sub_cmd.? <span class="tok-kw">else</span> <span class="tok-null">null</span>;</span>
<span class="line" id="L173">        }</span>
<span class="line" id="L174"></span>
<span class="line" id="L175">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Options.</span></span>
<span class="line" id="L176">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getOpts</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) !StringHashMap(OptionT) {</span>
<span class="line" id="L177">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.CommandNotInitialized;</span>
<span class="line" id="L178">            <span class="tok-kw">return</span> self.getOptsAlloc(self._alloc.?);</span>
<span class="line" id="L179">        }</span>
<span class="line" id="L180">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Options using the provided Allocator (`alloc`).</span></span>
<span class="line" id="L181">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getOptsAlloc</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), alloc: mem.Allocator) !StringHashMap(OptionT) {</span>
<span class="line" id="L182">            <span class="tok-kw">if</span> (self.opts == <span class="tok-null">null</span>) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.NoOptionsInCommand;</span>
<span class="line" id="L183">            <span class="tok-kw">var</span> map = StringHashMap(OptionT).init(alloc);</span>
<span class="line" id="L184">            <span class="tok-kw">for</span> (self.opts.?) |opt| { <span class="tok-kw">try</span> map.put(opt.name, opt); }</span>
<span class="line" id="L185">            <span class="tok-kw">return</span> map;</span>
<span class="line" id="L186">        }</span>
<span class="line" id="L187"></span>
<span class="line" id="L188">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Values.</span></span>
<span class="line" id="L189">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getVals</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) !StringHashMap(ValueT) {</span>
<span class="line" id="L190">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.CommandNotInitialized;</span>
<span class="line" id="L191">            <span class="tok-kw">return</span> self.getValsAlloc(self._alloc.?);</span>
<span class="line" id="L192">        }</span>
<span class="line" id="L193">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Values using the provided Allocator (`alloc`).</span></span>
<span class="line" id="L194">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getValsAlloc</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), alloc: mem.Allocator) !StringHashMap(ValueT) {</span>
<span class="line" id="L195">            <span class="tok-kw">if</span> (self.vals == <span class="tok-null">null</span>) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.NoValuesInCommand;</span>
<span class="line" id="L196">            <span class="tok-kw">var</span> map = StringHashMap(Value).init(alloc);</span>
<span class="line" id="L197">            <span class="tok-kw">for</span> (self.vals.?) |val| { <span class="tok-kw">try</span> map.put(val.name, val); }</span>
<span class="line" id="L198">            <span class="tok-kw">return</span> map;</span>
<span class="line" id="L199">        }</span>
<span class="line" id="L200"></span>
<span class="line" id="L201">        <span class="tok-comment">/// Creates the Help message for this Command and Writes it to the provided Writer (`writer`).</span></span>
<span class="line" id="L202">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">help</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), writer: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L203">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;{s}\n&quot;</span>, .{ self.help_prefix });</span>
<span class="line" id="L204"></span>
<span class="line" id="L205">            <span class="tok-kw">try</span> self.usage(writer);</span>
<span class="line" id="L206"></span>
<span class="line" id="L207">            <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L208">                <span class="tok-str">\\HELP:</span></span>

<span class="line" id="L209">                <span class="tok-str">\\    COMMAND: {s}</span></span>

<span class="line" id="L210">                <span class="tok-str">\\</span></span>

<span class="line" id="L211">                <span class="tok-str">\\    DESCRIPTION: {s}</span></span>

<span class="line" id="L212">                <span class="tok-str">\\</span></span>

<span class="line" id="L213">                <span class="tok-str">\\</span></span>

<span class="line" id="L214">                , .{ self.name, self.description }</span>
<span class="line" id="L215">            );</span>
<span class="line" id="L216">            </span>
<span class="line" id="L217">            <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L218">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;    SUB COMMANDS:\n&quot;</span>, .{});</span>
<span class="line" id="L219">                <span class="tok-kw">for</span> (self.sub_cmds.?) |cmd| {</span>
<span class="line" id="L220">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;        &quot;</span>, .{});</span>
<span class="line" id="L221">                    <span class="tok-kw">try</span> writer.print(subcmds_help_fmt, .{cmd.name, cmd.description});</span>
<span class="line" id="L222">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L223">                }</span>
<span class="line" id="L224">            }</span>
<span class="line" id="L225">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L226"></span>
<span class="line" id="L227">            <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L228">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;    OPTIONS:\n&quot;</span>, .{});</span>
<span class="line" id="L229">                <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L230">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;        &quot;</span>, .{});</span>
<span class="line" id="L231">                    <span class="tok-kw">try</span> opt.help(writer);</span>
<span class="line" id="L232">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L233">                }</span>
<span class="line" id="L234">            }</span>
<span class="line" id="L235">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L236"></span>
<span class="line" id="L237">            <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L238">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;    VALUES:\n&quot;</span>, .{});</span>
<span class="line" id="L239">                <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L240">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;        &quot;</span>, .{});</span>
<span class="line" id="L241">                    <span class="tok-kw">try</span> writer.print(vals_help_fmt, .{ val.name(), val.valType(), val.description() });</span>
<span class="line" id="L242">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L243">                }</span>
<span class="line" id="L244">            }</span>
<span class="line" id="L245">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L246">        }</span>
<span class="line" id="L247"></span>
<span class="line" id="L248">        <span class="tok-comment">/// Creates the Usage message for this Command and Writes it to the provided Writer (`writer`).</span></span>
<span class="line" id="L249">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">usage</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), writer: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L250">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;USAGE: {s} &quot;</span>, .{ self.name });</span>
<span class="line" id="L251">            <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L252">                <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L253">                    <span class="tok-kw">try</span> opt.usage(writer);</span>
<span class="line" id="L254">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot; &quot;</span>, .{});</span>
<span class="line" id="L255">                }</span>
<span class="line" id="L256">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;| &quot;</span>, .{});</span>
<span class="line" id="L257">            }</span>
<span class="line" id="L258">            <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L259">                <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L260">                    <span class="tok-kw">try</span> writer.print(vals_usage_fmt, .{ val.name(), val.valType() });</span>
<span class="line" id="L261">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot; &quot;</span>, .{});</span>
<span class="line" id="L262">                }</span>
<span class="line" id="L263">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;| &quot;</span>, .{});</span>
<span class="line" id="L264">            }</span>
<span class="line" id="L265">            <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L266">                <span class="tok-kw">for</span> (self.sub_cmds.?) |cmd| {</span>
<span class="line" id="L267">                    <span class="tok-kw">try</span> writer.print(subcmds_usage_fmt, .{ cmd.name });</span>
<span class="line" id="L268">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot; &quot;</span>, .{});</span>
<span class="line" id="L269">                }</span>
<span class="line" id="L270">            } </span>
<span class="line" id="L271"></span>
<span class="line" id="L272">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n\n&quot;</span>, .{});</span>
<span class="line" id="L273">        }</span>
<span class="line" id="L274"></span>
<span class="line" id="L275">        <span class="tok-comment">/// Check if Usage or Help have been set and call their respective methods.</span></span>
<span class="line" id="L276">        <span class="tok-comment">/// Output will be written to the provided Writer (`writer`).</span></span>
<span class="line" id="L277">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">checkUsageHelp</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), writer: <span class="tok-kw">anytype</span>) !<span class="tok-type">bool</span> {</span>
<span class="line" id="L278">            <span class="tok-kw">if</span> (self.checkFlag(<span class="tok-str">&quot;usage&quot;</span>)) {</span>
<span class="line" id="L279">                <span class="tok-kw">try</span> self.usage(writer);</span>
<span class="line" id="L280">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L281">            }</span>
<span class="line" id="L282">            <span class="tok-kw">if</span> (self.checkFlag(<span class="tok-str">&quot;help&quot;</span>)) {</span>
<span class="line" id="L283">                <span class="tok-kw">try</span> self.help(writer);</span>
<span class="line" id="L284">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L285">            }</span>
<span class="line" id="L286">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L287">        }</span>
<span class="line" id="L288"></span>
<span class="line" id="L289">        <span class="tok-comment">/// Check if a Flag (`flag_name`) has been set on this Command as a Command, Option, or Value.</span></span>
<span class="line" id="L290">        <span class="tok-comment">/// This is particularly useful for checking if Help or Usage has been called.</span></span>
<span class="line" id="L291">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">checkFlag</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), flag_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L292">            <span class="tok-kw">return</span> (</span>
<span class="line" id="L293">                (self.sub_cmd != <span class="tok-null">null</span> <span class="tok-kw">and</span> mem.eql(<span class="tok-type">u8</span>, self.sub_cmd.?.name, flag_name)) <span class="tok-kw">or</span></span>
<span class="line" id="L294">                checkOpt: {</span>
<span class="line" id="L295">                    <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L296">                        <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L297">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, opt.name, flag_name) <span class="tok-kw">and</span> </span>
<span class="line" id="L298">                                mem.eql(<span class="tok-type">u8</span>, opt.val.valType(), <span class="tok-str">&quot;bool&quot;</span>) <span class="tok-kw">and</span> </span>
<span class="line" id="L299">                                opt.val.getAs(<span class="tok-type">bool</span>) <span class="tok-kw">catch</span> <span class="tok-null">false</span>)</span>
<span class="line" id="L300">                                    <span class="tok-kw">break</span> :checkOpt <span class="tok-null">true</span>;</span>
<span class="line" id="L301">                        }</span>
<span class="line" id="L302">                    }</span>
<span class="line" id="L303">                    <span class="tok-kw">break</span> :checkOpt <span class="tok-null">false</span>;</span>
<span class="line" id="L304">                } <span class="tok-kw">or</span></span>
<span class="line" id="L305">                checkVal: {</span>
<span class="line" id="L306">                    <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L307">                        <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L308">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, val.name(), flag_name) <span class="tok-kw">and</span></span>
<span class="line" id="L309">                                mem.eql(<span class="tok-type">u8</span>, val.valType(), <span class="tok-str">&quot;bool&quot;</span>) <span class="tok-kw">and</span></span>
<span class="line" id="L310">                                val.getAs(<span class="tok-type">bool</span>) <span class="tok-kw">catch</span> <span class="tok-null">false</span>)</span>
<span class="line" id="L311">                                    <span class="tok-kw">break</span> :checkVal <span class="tok-null">true</span>;</span>
<span class="line" id="L312">                        }</span>
<span class="line" id="L313">                    }</span>
<span class="line" id="L314">                    <span class="tok-kw">break</span> :checkVal <span class="tok-null">false</span>;</span>
<span class="line" id="L315">                }</span>
<span class="line" id="L316">            );</span>
<span class="line" id="L317">        }</span>
<span class="line" id="L318"></span>
<span class="line" id="L319">        <span class="tok-comment">/// Config for creating Commands from Structs using `from()`.</span></span>
<span class="line" id="L320">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> FromConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L321">            <span class="tok-comment">/// Ignore incompatible types.</span></span>
<span class="line" id="L322">            ignore_incompatible: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L323">            <span class="tok-comment">/// Ignore prefix.</span></span>
<span class="line" id="L324">            <span class="tok-comment">/// Any Field that matches this prefix will not be converted in to an Argument Type.</span></span>
<span class="line" id="L325">            <span class="tok-comment">/// Setting this to `null` will disable prefix checks.</span></span>
<span class="line" id="L326">            ignore_prefix: ?[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;_&quot;</span>,</span>
<span class="line" id="L327">            <span class="tok-comment">/// Ignore the first field or parameter.</span></span>
<span class="line" id="L328">            <span class="tok-comment">/// This is particularly useful when converting a Function that has a `self` parameter.</span></span>
<span class="line" id="L329">            ignore_first: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L330">            <span class="tok-comment">/// Convert underscores '_' to dashes '-' in field names.</span></span>
<span class="line" id="L331">            <span class="tok-comment">/// Be sure to set the counterpart to this flag in the `ToConfig` if this Command will be converted back to a Struct or Union.</span></span>
<span class="line" id="L332">            convert_syntax: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L333">            <span class="tok-comment">/// Attempt to create Short Options.</span></span>
<span class="line" id="L334">            <span class="tok-comment">/// This will attempt to make a short option name from the first letter of the field name in lowercase then uppercase, sequentially working through each next letter if the previous one has already been used. (Note, user must deconflict for 'u' and 'h' if using auto-generated Usage/Help Options.)</span></span>
<span class="line" id="L335">            attempt_short_opts: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L336"></span>
<span class="line" id="L337">            <span class="tok-comment">/// A Name for the Command.</span></span>
<span class="line" id="L338">            <span class="tok-comment">/// A blank value will default to the type name of the Struct.</span></span>
<span class="line" id="L339">            cmd_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L340">            <span class="tok-comment">/// A Description for the Command.</span></span>
<span class="line" id="L341">            cmd_description: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L342">            <span class="tok-comment">/// A Help Prefix for the Command.</span></span>
<span class="line" id="L343">            cmd_help_prefix: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = global_help_prefix,</span>
<span class="line" id="L344"></span>
<span class="line" id="L345">            <span class="tok-comment">/// Descriptions of the Command's Arguments (Sub Commands, Options, and Values).</span></span>
<span class="line" id="L346">            <span class="tok-comment">/// These Descriptions will be used across this Command and all of its Sub Commands.</span></span>
<span class="line" id="L347">            <span class="tok-comment">///</span></span>
<span class="line" id="L348">            <span class="tok-comment">/// Format: `.{ &quot;argument_name&quot;, &quot;Description of the Argument.&quot; }`</span></span>
<span class="line" id="L349">            sub_descriptions: []<span class="tok-kw">const</span> <span class="tok-kw">struct</span> { []<span class="tok-kw">const</span> <span class="tok-type">u8</span>, []<span class="tok-kw">const</span> <span class="tok-type">u8</span> } = &amp;.{ .{ <span class="tok-str">&quot;__nosubdescriptionsprovided__&quot;</span>, <span class="tok-str">&quot;&quot;</span> } },</span>
<span class="line" id="L350">            <span class="tok-comment">/// During parsing, mandate that a Sub Command be used with a Command if one is available.</span></span>
<span class="line" id="L351">            <span class="tok-comment">/// This will not include Usage/Help Commands.</span></span>
<span class="line" id="L352">            sub_cmds_mandatory: ?<span class="tok-type">bool</span> = <span class="tok-null">null</span>,</span>
<span class="line" id="L353">            <span class="tok-comment">/// During parsing, mandate that all Values for a Command must be filled, otherwise error out.</span></span>
<span class="line" id="L354">            <span class="tok-comment">/// This should generally be set to `true`. Prefer to use Options over Values for Arguments that are not mandatory.</span></span>
<span class="line" id="L355">            vals_mandatory: ?<span class="tok-type">bool</span> = <span class="tok-null">null</span>,</span>
<span class="line" id="L356"></span>
<span class="line" id="L357">            <span class="tok-comment">/// Max number of Sub Commands.</span></span>
<span class="line" id="L358">            max_cmds: <span class="tok-type">u8</span> = max_args,</span>
<span class="line" id="L359">            <span class="tok-comment">/// Max number of Options.</span></span>
<span class="line" id="L360">            max_opts: <span class="tok-type">u8</span> = max_args,</span>
<span class="line" id="L361">            <span class="tok-comment">/// Max number of Values.</span></span>
<span class="line" id="L362">            max_vals: <span class="tok-type">u8</span> = max_args,</span>
<span class="line" id="L363">        };</span>
<span class="line" id="L364">        </span>
<span class="line" id="L365">        <span class="tok-comment">/// Create a Command from the provided Type (`FromT`).</span></span>
<span class="line" id="L366">        <span class="tok-comment">/// The provided Type must be a Comptime-known Function, Struct, or Union.</span></span>
<span class="line" id="L367">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">from</span>(<span class="tok-kw">comptime</span> FromT: <span class="tok-type">type</span>, <span class="tok-kw">comptime</span> from_config: FromConfig) <span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L368">            <span class="tok-kw">const</span> from_info = <span class="tok-builtin">@typeInfo</span>(FromT);</span>
<span class="line" id="L369">            <span class="tok-kw">return</span> <span class="tok-kw">switch</span> (from_info) {</span>
<span class="line" id="L370">                .Fn =&gt; fromFn(FromT, from_config),</span>
<span class="line" id="L371">                .Struct, .Union =&gt; fromStructOrUnion(FromT, from_config),</span>
<span class="line" id="L372">                <span class="tok-kw">else</span> =&gt; <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The provided type '&quot;</span> ++ <span class="tok-builtin">@typeName</span>(FromT) ++ <span class="tok-str">&quot;' must be a Function, Struct, or Union.&quot;</span>),</span>
<span class="line" id="L373">            };</span>
<span class="line" id="L374">        }</span>
<span class="line" id="L375"></span>
<span class="line" id="L376">        <span class="tok-comment">/// Create a Command from the provided Struct (`FromStruct`).</span></span>
<span class="line" id="L377">        <span class="tok-comment">/// The provided Struct must be Comptime-known.</span></span>
<span class="line" id="L378">        <span class="tok-comment">///</span></span>
<span class="line" id="L379">        <span class="tok-comment">/// Field Types are converted as follows:</span></span>
<span class="line" id="L380">        <span class="tok-comment">/// - Functions, Structs, Unions = Commands</span></span>
<span class="line" id="L381">        <span class="tok-comment">/// - Valid Values = Single-Values (Valid Values can be found under `Value.zig/Generic`.)</span></span>
<span class="line" id="L382">        <span class="tok-comment">/// - Valid Optionals = Single-Options (Valid Optionals are nullable versions of Valid Values.)</span></span>
<span class="line" id="L383">        <span class="tok-comment">/// - Arrays of Valid Values = Multi-Values</span></span>
<span class="line" id="L384">        <span class="tok-comment">/// - Arrays of Valid Optionals = Multi-Options </span></span>
<span class="line" id="L385">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">fromStructOrUnion</span>(<span class="tok-kw">comptime</span> FromT: <span class="tok-type">type</span>, <span class="tok-kw">comptime</span> from_config: FromConfig) <span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L386">            <span class="tok-kw">const</span> from_info = <span class="tok-builtin">@typeInfo</span>(FromT);</span>
<span class="line" id="L387">            <span class="tok-kw">if</span> (from_info != .Struct <span class="tok-kw">and</span> from_info != .Union) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;Provided Type is not a Struct or Union.&quot;</span>);</span>
<span class="line" id="L388"></span>
<span class="line" id="L389">            <span class="tok-kw">var</span> from_cmds_buf: [from_config.max_cmds]<span class="tok-builtin">@This</span>() = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L390">            <span class="tok-kw">const</span> from_cmds = from_cmds_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L391">            <span class="tok-kw">var</span> cmds_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L392">            <span class="tok-kw">var</span> from_opts_buf: [from_config.max_opts]OptionT = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L393">            <span class="tok-kw">const</span> from_opts = from_opts_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L394">            <span class="tok-kw">var</span> opts_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L395">            <span class="tok-kw">var</span> short_names_buf: [from_config.max_opts]<span class="tok-type">u8</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L396">            <span class="tok-kw">const</span> short_names = short_names_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L397">            <span class="tok-kw">var</span> short_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L398">            <span class="tok-kw">var</span> from_vals_buf: [from_config.max_vals]ValueT = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L399">            <span class="tok-kw">const</span> from_vals = from_vals_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L400">            <span class="tok-kw">var</span> vals_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L401"></span>
<span class="line" id="L402">            <span class="tok-kw">const</span> arg_descriptions = ComptimeStringMap([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, from_config.sub_descriptions);</span>
<span class="line" id="L403"></span>
<span class="line" id="L404">            <span class="tok-kw">const</span> fields = meta.fields(FromT);</span>
<span class="line" id="L405">            <span class="tok-kw">const</span> start_idx = <span class="tok-kw">if</span> (from_config.ignore_first) <span class="tok-number">1</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L406">            <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (fields[start_idx..]) |field| {</span>
<span class="line" id="L407">                <span class="tok-kw">if</span> (from_config.ignore_prefix) |prefix| {</span>
<span class="line" id="L408">                    <span class="tok-kw">if</span> (field.name.len &gt; prefix.len <span class="tok-kw">and</span> mem.eql(<span class="tok-type">u8</span>, field.name[<span class="tok-number">0</span>..prefix.len], prefix)) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L409">                }</span>
<span class="line" id="L410">                <span class="tok-kw">var</span> arg_name_buf: [field.name.len]<span class="tok-type">u8</span> = field.name[<span class="tok-number">0</span>..].*;</span>
<span class="line" id="L411">                <span class="tok-kw">const</span> arg_name = <span class="tok-kw">if</span> (!from_config.convert_syntax) field.name <span class="tok-kw">else</span> argName: {</span>
<span class="line" id="L412">                    _ = mem.replace(<span class="tok-type">u8</span>, field.name[<span class="tok-number">1</span>..], <span class="tok-str">&quot;_&quot;</span>, <span class="tok-str">&quot;-&quot;</span>, arg_name_buf[<span class="tok-number">1</span>..]);</span>
<span class="line" id="L413">                    <span class="tok-kw">break</span> :argName arg_name_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L414">                };</span>
<span class="line" id="L415">                <span class="tok-kw">const</span> arg_description = arg_descriptions.get(field.name);</span>
<span class="line" id="L416">                <span class="tok-comment">// Handle Argument Types.</span>
</span>
<span class="line" id="L417">                <span class="tok-kw">switch</span> (field.<span class="tok-type">type</span>) {</span>
<span class="line" id="L418">                    <span class="tok-builtin">@This</span>() =&gt; {</span>
<span class="line" id="L419">                        <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) {</span>
<span class="line" id="L420">                            from_cmds[cmds_idx] = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L421">                            cmds_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L422">                            <span class="tok-kw">continue</span>;</span>
<span class="line" id="L423">                        }</span>
<span class="line" id="L424">                    },</span>
<span class="line" id="L425">                    OptionT =&gt; {</span>
<span class="line" id="L426">                        <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) {</span>
<span class="line" id="L427">                            from_opts[opts_idx] = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L428">                            opts_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L429">                            <span class="tok-kw">continue</span>;</span>
<span class="line" id="L430">                        }</span>
<span class="line" id="L431">                    },</span>
<span class="line" id="L432">                    ValueT =&gt; {</span>
<span class="line" id="L433">                        <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) {</span>
<span class="line" id="L434">                            from_vals[vals_idx] = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L435">                            vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L436">                            <span class="tok-kw">continue</span>;</span>
<span class="line" id="L437">                        }</span>
<span class="line" id="L438">                    },</span>
<span class="line" id="L439">                    <span class="tok-kw">inline</span> <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L440">                }</span>
<span class="line" id="L441"></span>
<span class="line" id="L442">                <span class="tok-kw">const</span> field_info = <span class="tok-builtin">@typeInfo</span>(field.<span class="tok-type">type</span>);</span>
<span class="line" id="L443">                <span class="tok-comment">// Handle non-Argument Types.</span>
</span>
<span class="line" id="L444">                <span class="tok-kw">switch</span> (field_info) {</span>
<span class="line" id="L445">                    <span class="tok-comment">// Commands</span>
</span>
<span class="line" id="L446">                    .Fn, .Struct =&gt; {</span>
<span class="line" id="L447">                        <span class="tok-kw">const</span> sub_config = <span class="tok-kw">comptime</span> subConfig: {</span>
<span class="line" id="L448">                            <span class="tok-kw">var</span> new_config = from_config;</span>
<span class="line" id="L449">                            new_config.cmd_name = arg_name;</span>
<span class="line" id="L450">                            new_config.cmd_description = arg_description <span class="tok-kw">orelse</span> <span class="tok-str">&quot;The '&quot;</span> ++ arg_name ++ <span class="tok-str">&quot;' Command.&quot;</span>;</span>
<span class="line" id="L451">                            <span class="tok-kw">break</span> :subConfig new_config;</span>
<span class="line" id="L452">                        };</span>
<span class="line" id="L453">                        from_cmds[cmds_idx] = from(field.<span class="tok-type">type</span>, sub_config);</span>
<span class="line" id="L454">                        cmds_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L455">                    },</span>
<span class="line" id="L456">                    <span class="tok-comment">// Options</span>
</span>
<span class="line" id="L457">                    <span class="tok-comment">// TODO - Handle Command types passed as Optionals?</span>
</span>
<span class="line" id="L458">                    .Optional =&gt; {</span>
<span class="line" id="L459">                        <span class="tok-kw">const</span> short_name = shortName: {</span>
<span class="line" id="L460">                            <span class="tok-kw">if</span> (!from_config.attempt_short_opts) <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L461">                            <span class="tok-kw">for</span> (arg_name) |char| {</span>
<span class="line" id="L462">                                <span class="tok-kw">const</span> ul_chars: [<span class="tok-number">2</span>]<span class="tok-type">u8</span> = .{ toLower(char), toUpper(char) };</span>
<span class="line" id="L463">                                <span class="tok-kw">for</span> (ul_chars) |ul| {</span>
<span class="line" id="L464">                                    <span class="tok-kw">if</span> (short_idx &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> indexOfEql(<span class="tok-type">u8</span>, short_names[<span class="tok-number">0</span>..short_idx], ul) != <span class="tok-null">null</span>) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L465">                                    short_names[short_idx] = ul;</span>
<span class="line" id="L466">                                    short_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L467">                                    <span class="tok-kw">break</span> :shortName ul;</span>
<span class="line" id="L468">                                }</span>
<span class="line" id="L469">                            }</span>
<span class="line" id="L470">                            <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L471">                        };</span>
<span class="line" id="L472">                        from_opts[opts_idx] = (OptionT.from(field, .{ </span>
<span class="line" id="L473">                            .name = arg_name,</span>
<span class="line" id="L474">                            .short_name = short_name, </span>
<span class="line" id="L475">                            .long_name = arg_name,</span>
<span class="line" id="L476">                            .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L477">                            .opt_description = arg_description</span>
<span class="line" id="L478">                        }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>);</span>
<span class="line" id="L479">                        opts_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L480">                    },</span>
<span class="line" id="L481">                    <span class="tok-comment">// Values</span>
</span>
<span class="line" id="L482">                    .Bool, .Int, .Float, .Pointer =&gt; {</span>
<span class="line" id="L483">                        from_vals[vals_idx] = (ValueT.from(field, .{</span>
<span class="line" id="L484">                            .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L485">                            .val_name = arg_name,</span>
<span class="line" id="L486">                            .val_description = arg_description</span>
<span class="line" id="L487">                        }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>);</span>
<span class="line" id="L488">                        vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L489">                    },</span>
<span class="line" id="L490">                    <span class="tok-comment">// Multi</span>
</span>
<span class="line" id="L491">                    .Array =&gt; |ary| {</span>
<span class="line" id="L492">                        <span class="tok-kw">const</span> ary_info = <span class="tok-builtin">@typeInfo</span>(ary.child);</span>
<span class="line" id="L493">                        <span class="tok-kw">switch</span> (ary_info) {</span>
<span class="line" id="L494">                            <span class="tok-comment">// Options</span>
</span>
<span class="line" id="L495">                            .Optional =&gt; {</span>
<span class="line" id="L496">                                <span class="tok-kw">const</span> short_name = shortName: {</span>
<span class="line" id="L497">                                    <span class="tok-kw">if</span> (!from_config.attempt_short_opts) <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L498">                                    <span class="tok-kw">for</span> (arg_name) |char| {</span>
<span class="line" id="L499">                                        <span class="tok-kw">const</span> ul_chars: [<span class="tok-number">2</span>]<span class="tok-type">u8</span> = .{ toLower(char), toUpper(char) };</span>
<span class="line" id="L500">                                        <span class="tok-kw">for</span> (ul_chars) |ul| {</span>
<span class="line" id="L501">                                            <span class="tok-kw">if</span> (short_idx &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> indexOfEql(<span class="tok-type">u8</span>, short_names[<span class="tok-number">0</span>..short_idx], ul) != <span class="tok-null">null</span>) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L502">                                            short_names[short_idx] = ul;</span>
<span class="line" id="L503">                                            short_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L504">                                            <span class="tok-kw">break</span> :shortName ul;</span>
<span class="line" id="L505">                                        }</span>
<span class="line" id="L506">                                    }</span>
<span class="line" id="L507">                                    <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L508">                                };</span>
<span class="line" id="L509">                                from_opts[opts_idx] = OptionT.from(field, .{</span>
<span class="line" id="L510">                                    .name = arg_name,</span>
<span class="line" id="L511">                                    .short_name = short_name, </span>
<span class="line" id="L512">                                    .long_name = arg_name,</span>
<span class="line" id="L513">                                    .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L514">                                    .opt_description = arg_description</span>
<span class="line" id="L515">                                }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>;</span>
<span class="line" id="L516">                                opts_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L517">                            },</span>
<span class="line" id="L518">                            <span class="tok-comment">// Values</span>
</span>
<span class="line" id="L519">                            .Bool, .Int, .Float, .Pointer =&gt; {</span>
<span class="line" id="L520">                                from_vals[vals_idx] = ValueT.from(field, .{</span>
<span class="line" id="L521">                                    .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L522">                                    .val_name = arg_name,</span>
<span class="line" id="L523">                                    .val_description = arg_description</span>
<span class="line" id="L524">                                }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>;</span>
<span class="line" id="L525">                                vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L526">                            },</span>
<span class="line" id="L527">                            <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!from_config.ignore_incompatible) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The field '&quot;</span> ++ field.name ++ <span class="tok-str">&quot;' of type 'Array' is incompatible. Arrays must contain one of the following types: Bool, Int, Float, Pointer (const u8), or their Optional counterparts.&quot;</span>),</span>
<span class="line" id="L528">                        }</span>
<span class="line" id="L529">                    },</span>
<span class="line" id="L530">                    <span class="tok-comment">// Incompatible</span>
</span>
<span class="line" id="L531">                    <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!from_config.ignore_incompatible) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The field '&quot;</span> ++ field.name ++ <span class="tok-str">&quot;' of type '&quot;</span> ++ <span class="tok-builtin">@typeName</span>(field.<span class="tok-type">type</span>) ++ <span class="tok-str">&quot;' is incompatible as it cannot be converted to a Command, Option, or Value.&quot;</span>),</span>
<span class="line" id="L532">                }</span>
<span class="line" id="L533">            }</span>
<span class="line" id="L534"></span>
<span class="line" id="L535">            <span class="tok-kw">var</span> cmd_name_buf: [<span class="tok-builtin">@typeName</span>(FromT).len]<span class="tok-type">u8</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L536">            <span class="tok-kw">const</span> cmd_name = <span class="tok-kw">if</span> (from_config.cmd_name.len &gt; <span class="tok-number">0</span>) from_config.cmd_name <span class="tok-kw">else</span> cmdName: {</span>
<span class="line" id="L537">                <span class="tok-kw">if</span> (!from_config.convert_syntax) <span class="tok-kw">break</span> :cmdName <span class="tok-builtin">@typeName</span>(FromT) <span class="tok-kw">else</span> {</span>
<span class="line" id="L538">                    _ = mem.replace(<span class="tok-type">u8</span>, <span class="tok-builtin">@typeName</span>(FromT), <span class="tok-str">&quot;_&quot;</span>, <span class="tok-str">&quot;-&quot;</span>, cmd_name_buf[<span class="tok-number">0</span>..]);</span>
<span class="line" id="L539">                    <span class="tok-kw">break</span> :cmdName cmd_name_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L540">                }</span>
<span class="line" id="L541">            };</span>
<span class="line" id="L542">            <span class="tok-kw">return</span> <span class="tok-builtin">@This</span>(){</span>
<span class="line" id="L543">                .name = cmd_name,</span>
<span class="line" id="L544">                .description = from_config.cmd_description,</span>
<span class="line" id="L545">                .help_prefix = from_config.cmd_help_prefix,</span>
<span class="line" id="L546">                .sub_cmds = <span class="tok-kw">if</span> (cmds_idx &gt; <span class="tok-number">0</span>) from_cmds[<span class="tok-number">0</span>..cmds_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L547">                .opts = <span class="tok-kw">if</span> (opts_idx &gt; <span class="tok-number">0</span>) from_opts[<span class="tok-number">0</span>..opts_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L548">                .vals = <span class="tok-kw">if</span> (vals_idx &gt; <span class="tok-number">0</span>) from_vals[<span class="tok-number">0</span>..vals_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L549">                .sub_cmds_mandatory = <span class="tok-kw">if</span> (from_config.sub_cmds_mandatory) |config_sub_man| config_sub_man <span class="tok-kw">else</span> config.sub_cmds_mandatory,</span>
<span class="line" id="L550">                .vals_mandatory = <span class="tok-kw">if</span> (from_config.vals_mandatory) |config_vals_man| config_vals_man <span class="tok-kw">else</span> config.vals_mandatory,</span>
<span class="line" id="L551">            };</span>
<span class="line" id="L552">        }</span>
<span class="line" id="L553"></span>
<span class="line" id="L554">        <span class="tok-comment">/// Create a Command from the provided Function (`from_fn`).</span></span>
<span class="line" id="L555">        <span class="tok-comment">/// The provided Function must be Comptime-known.</span></span>
<span class="line" id="L556">        <span class="tok-comment">///</span></span>
<span class="line" id="L557">        <span class="tok-comment">/// Types are converted as follows:</span></span>
<span class="line" id="L558">        <span class="tok-comment">/// - Functions, Structs, Unions = Commands</span></span>
<span class="line" id="L559">        <span class="tok-comment">/// - Valid Single-Parameters = Single-Values (Valid Values can be found under `Value.zig/Generic`.)</span></span>
<span class="line" id="L560">        <span class="tok-comment">/// - Valid Array/Slice-Parameters = Multi-Values</span></span>
<span class="line" id="L561">        <span class="tok-comment">/// - Note: Options can not be generated from Functions due to the lack of parameter names in `std.builtin.Type.Fn.Param`.</span></span>
<span class="line" id="L562">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">fromFn</span>(<span class="tok-kw">comptime</span> FromFn: <span class="tok-type">type</span>, <span class="tok-kw">comptime</span> from_config: FromConfig) <span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L563">            <span class="tok-kw">const</span> from_info = <span class="tok-builtin">@typeInfo</span>(FromFn);</span>
<span class="line" id="L564">            <span class="tok-kw">if</span> (from_info != .Fn) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;Provided Type is not a Function.&quot;</span>);</span>
<span class="line" id="L565"></span>
<span class="line" id="L566">            <span class="tok-kw">var</span> from_cmds_buf: [from_config.max_cmds]<span class="tok-builtin">@This</span>() = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L567">            <span class="tok-kw">const</span> from_cmds = from_cmds_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L568">            <span class="tok-kw">var</span> cmds_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L569">            <span class="tok-kw">var</span> from_vals_buf: [from_config.max_vals]ValueT = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L570">            <span class="tok-kw">const</span> from_vals = from_vals_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L571">            <span class="tok-kw">var</span> vals_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L572"></span>
<span class="line" id="L573">            <span class="tok-comment">//const arg_descriptions = ComptimeStringMap([]const u8, from_config.sub_descriptions);</span>
</span>
<span class="line" id="L574"></span>
<span class="line" id="L575">            <span class="tok-kw">const</span> params = from_info.Fn.params;</span>
<span class="line" id="L576">            <span class="tok-kw">const</span> start_idx = <span class="tok-kw">if</span> (from_config.ignore_first) <span class="tok-number">1</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L577">            <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (params[start_idx..]) |param| {</span>
<span class="line" id="L578">                <span class="tok-kw">const</span> arg_description = <span class="tok-str">&quot;No description. (Descriptions cannot currently be generated from Function Parameters.)&quot;</span>;<span class="tok-comment">//arg_descriptions.get(param.name);</span>
</span>
<span class="line" id="L579">                <span class="tok-comment">// Handle Argument Types.</span>
</span>
<span class="line" id="L580">                <span class="tok-kw">switch</span> (<span class="tok-builtin">@typeInfo</span>(param.<span class="tok-type">type</span>.?)) {</span>
<span class="line" id="L581">                    <span class="tok-comment">// Commands</span>
</span>
<span class="line" id="L582">                    .Fn, .Struct, .Union =&gt; {</span>
<span class="line" id="L583">                        <span class="tok-kw">const</span> sub_config = <span class="tok-kw">comptime</span> subConfig: {</span>
<span class="line" id="L584">                            <span class="tok-kw">var</span> new_config = from_config;</span>
<span class="line" id="L585">                            new_config.cmd_name = <span class="tok-str">&quot;cmd-&quot;</span> ++ &amp;.{ cmds_idx + <span class="tok-number">48</span> };</span>
<span class="line" id="L586">                            new_config.cmd_description = arg_description <span class="tok-kw">orelse</span> <span class="tok-str">&quot;The '&quot;</span> ++ new_config.cmd_name ++ <span class="tok-str">&quot;' Command.&quot;</span>;</span>
<span class="line" id="L587">                            <span class="tok-kw">break</span> :subConfig new_config;</span>
<span class="line" id="L588">                        };</span>
<span class="line" id="L589">                        from_cmds[cmds_idx] = from(param.<span class="tok-type">type</span>, sub_config);</span>
<span class="line" id="L590">                        cmds_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L591">                    },</span>
<span class="line" id="L592">                    <span class="tok-comment">// Values</span>
</span>
<span class="line" id="L593">                    .Bool, .Int, .Float, .Optional, .Pointer =&gt; {</span>
<span class="line" id="L594">                        from_vals[vals_idx] = (ValueT.from(param, .{</span>
<span class="line" id="L595">                            .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L596">                            .val_name = <span class="tok-str">&quot;val-&quot;</span> ++ .{ <span class="tok-str">'0'</span>, (vals_idx + <span class="tok-number">48</span>), },</span>
<span class="line" id="L597">                            .val_description = arg_description</span>
<span class="line" id="L598">                        }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>);</span>
<span class="line" id="L599">                        vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L600">                    },</span>
<span class="line" id="L601">                    <span class="tok-comment">// Multi</span>
</span>
<span class="line" id="L602">                    .Array =&gt; |ary| {</span>
<span class="line" id="L603">                        <span class="tok-kw">const</span> ary_info = <span class="tok-builtin">@typeInfo</span>(ary.child);</span>
<span class="line" id="L604">                        <span class="tok-kw">switch</span> (ary_info) {</span>
<span class="line" id="L605">                            <span class="tok-comment">// Values</span>
</span>
<span class="line" id="L606">                            .Bool, .Int, .Float, .Optional, .Pointer =&gt; {</span>
<span class="line" id="L607">                                from_vals[vals_idx] = ValueT.from(param, .{</span>
<span class="line" id="L608">                                    .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L609">                                    .val_description = arg_description</span>
<span class="line" id="L610">                                }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>;</span>
<span class="line" id="L611">                                vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L612">                            },</span>
<span class="line" id="L613">                            <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!from_config.ignore_incompatible) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The parameter of type 'Array' is incompatible. Arrays must contain one of the following types: Bool, Int, Float, Pointer (const u8), or their Optional counterparts.&quot;</span>),</span>
<span class="line" id="L614">                        }</span>
<span class="line" id="L615">                    },</span>
<span class="line" id="L616">                    <span class="tok-comment">// Incompatible</span>
</span>
<span class="line" id="L617">                    <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!from_config.ignore_incompatible) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The parameter of type '&quot;</span> ++ <span class="tok-builtin">@typeName</span>(param.<span class="tok-type">type</span>) ++ <span class="tok-str">&quot;' is incompatible as it cannot be converted to a Command or Value.&quot;</span>),</span>
<span class="line" id="L618">                }</span>
<span class="line" id="L619">            }</span>
<span class="line" id="L620"></span>
<span class="line" id="L621">            <span class="tok-kw">return</span> <span class="tok-builtin">@This</span>(){</span>
<span class="line" id="L622">                .name = <span class="tok-kw">if</span> (from_config.cmd_name.len &gt; <span class="tok-number">0</span>) from_config.cmd_name <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(FromFn),</span>
<span class="line" id="L623">                .description = from_config.cmd_description,</span>
<span class="line" id="L624">                .help_prefix = from_config.cmd_help_prefix,</span>
<span class="line" id="L625">                .sub_cmds = <span class="tok-kw">if</span> (cmds_idx &gt; <span class="tok-number">0</span>) from_cmds[<span class="tok-number">0</span>..cmds_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L626">                .vals = <span class="tok-kw">if</span> (vals_idx &gt; <span class="tok-number">0</span>) from_vals[<span class="tok-number">0</span>..vals_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L627">            };</span>
<span class="line" id="L628">        }</span>
<span class="line" id="L629"></span>
<span class="line" id="L630">        <span class="tok-comment">/// Config for creating Structs from Commands using `to()`.</span></span>
<span class="line" id="L631">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> ToConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L632">            <span class="tok-comment">/// Allow Unset Options and Values to be included.</span></span>
<span class="line" id="L633">            <span class="tok-comment">/// When this is active, an attempt will be made to use the Struct's default value (if available) in the event of an Unset Option/Value.</span></span>
<span class="line" id="L634">            allow_unset: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L635">            <span class="tok-comment">/// Ignore Incompatible types. Incompatible types are those that fall outside of the conversion rules listed under `from()`.</span></span>
<span class="line" id="L636">            <span class="tok-comment">/// When this is active, an attempt will be made to use the Struct's default value (if available) in the event of an Incompatible type.</span></span>
<span class="line" id="L637">            <span class="tok-comment">/// This will also allow Values to be set to sane defaults for Integers and Floats (0) as well as Strings (&quot;&quot;).</span></span>
<span class="line" id="L638">            allow_incompatible: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L639">            <span class="tok-comment">/// Convert dashes '-' to underscores '_' in field names.</span></span>
<span class="line" id="L640">            <span class="tok-comment">/// Be sure to set the counterpart to this flag in the `FromConfig` if this Command will be converted from a Struct or Union.</span></span>
<span class="line" id="L641">            convert_syntax: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L642">        };</span>
<span class="line" id="L643"></span>
<span class="line" id="L644">        <span class="tok-comment">/// Convert this Command to an instance of the provided Struct or Union Type (`toT`).</span></span>
<span class="line" id="L645">        <span class="tok-comment">/// This is the inverse of `from()`.</span></span>
<span class="line" id="L646">        <span class="tok-comment">///</span></span>
<span class="line" id="L647">        <span class="tok-comment">/// Types are converted as follows:</span></span>
<span class="line" id="L648">        <span class="tok-comment">/// - Commmands: Structs or Unions by recursively calling `to()`.</span></span>
<span class="line" id="L649">        <span class="tok-comment">/// - Single-Options: Optional versions of Values.</span></span>
<span class="line" id="L650">        <span class="tok-comment">/// - Single-Values: Booleans, Integers (Signed/Unsigned), and Pointers (`[]const u8`) only)</span></span>
<span class="line" id="L651">        <span class="tok-comment">/// - Multi-Options/Values: Arrays of the corresponding Optionals or Values.</span></span>
<span class="line" id="L652">        <span class="tok-comment">// TODO: Catch more error cases for incompatible types (i.e. Pointer not (`[]const u8`).</span>
</span>
<span class="line" id="L653">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">to</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), <span class="tok-kw">comptime</span> ToT: <span class="tok-type">type</span>, to_config: ToConfig) !ToT {</span>
<span class="line" id="L654">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.CommandNotInitialized;</span>
<span class="line" id="L655">            <span class="tok-kw">const</span> type_info = <span class="tok-builtin">@typeInfo</span>(ToT);</span>
<span class="line" id="L656">            <span class="tok-kw">if</span> (type_info == .Union) { </span>
<span class="line" id="L657">                <span class="tok-kw">const</span> vals_idx = <span class="tok-kw">if</span> (self.vals) |vals| valsIdx: {</span>
<span class="line" id="L658">                    <span class="tok-kw">var</span> idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L659">                    <span class="tok-kw">for</span> (vals) |val| { <span class="tok-kw">if</span> (val.isSet()) idx += <span class="tok-number">1</span>; }</span>
<span class="line" id="L660">                    <span class="tok-kw">break</span> :valsIdx idx;</span>
<span class="line" id="L661">                } <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L662">                <span class="tok-kw">const</span> opts_idx = <span class="tok-kw">if</span> (self.opts) |opts| optsIdx: {</span>
<span class="line" id="L663">                    <span class="tok-kw">var</span> idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L664">                    <span class="tok-kw">for</span> (opts) |opt| { </span>
<span class="line" id="L665">                        <span class="tok-kw">if</span> (</span>
<span class="line" id="L666">                            opt.val.isSet() <span class="tok-kw">and</span></span>
<span class="line" id="L667">                            !mem.eql(<span class="tok-type">u8</span>, opt.name, <span class="tok-str">&quot;usage&quot;</span>) <span class="tok-kw">and</span></span>
<span class="line" id="L668">                            !mem.eql(<span class="tok-type">u8</span>, opt.name, <span class="tok-str">&quot;help&quot;</span>)</span>
<span class="line" id="L669">                        ) idx += <span class="tok-number">1</span>; </span>
<span class="line" id="L670">                    }</span>
<span class="line" id="L671">                    <span class="tok-kw">break</span> :optsIdx idx;</span>
<span class="line" id="L672">                } <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L673">                <span class="tok-kw">const</span> total_idx = vals_idx + opts_idx;</span>
<span class="line" id="L674">                <span class="tok-kw">if</span> (total_idx &gt; <span class="tok-number">1</span>) { </span>
<span class="line" id="L675">                    log.err(<span class="tok-str">&quot;Commands from Unions can only hold 1 Value or Option, but '{d}' were given.&quot;</span>, .{ total_idx });</span>
<span class="line" id="L676">                    <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ExpectedOnlyOneValOrOpt;</span>
<span class="line" id="L677">                }</span>
<span class="line" id="L678">            }</span>
<span class="line" id="L679">            <span class="tok-kw">var</span> out: ToT = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L680">            <span class="tok-kw">const</span> fields = meta.fields(ToT);</span>
<span class="line" id="L681">            <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (fields) |field| {</span>
<span class="line" id="L682">                <span class="tok-kw">if</span> (field.<span class="tok-type">type</span> == <span class="tok-builtin">@This</span>() <span class="tok-kw">or</span> field.<span class="tok-type">type</span> == OptionT <span class="tok-kw">or</span> field.<span class="tok-type">type</span> == ValueT) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L683">                <span class="tok-kw">var</span> arg_name_buf: [field.name.len]<span class="tok-type">u8</span> = field.name[<span class="tok-number">0</span>..].*;</span>
<span class="line" id="L684">                <span class="tok-kw">const</span> arg_name = <span class="tok-kw">if</span> (!to_config.convert_syntax) field.name <span class="tok-kw">else</span> argName: {</span>
<span class="line" id="L685">                    _ = mem.replace(<span class="tok-type">u8</span>, field.name[<span class="tok-number">1</span>..], <span class="tok-str">&quot;_&quot;</span>, <span class="tok-str">&quot;-&quot;</span>, arg_name_buf[<span class="tok-number">1</span>..]);</span>
<span class="line" id="L686">                    <span class="tok-kw">break</span> :argName arg_name_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L687">                };</span>
<span class="line" id="L688">                <span class="tok-kw">const</span> field_info = <span class="tok-builtin">@typeInfo</span>(field.<span class="tok-type">type</span>);</span>
<span class="line" id="L689">                <span class="tok-kw">switch</span> (field_info) {</span>
<span class="line" id="L690">                    .Struct =&gt; <span class="tok-kw">if</span> (self.sub_cmd != <span class="tok-null">null</span> <span class="tok-kw">and</span> mem.eql(<span class="tok-type">u8</span>, self.sub_cmd.?.name, arg_name)) {</span>
<span class="line" id="L691">                        <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-kw">try</span> self.sub_cmd.?.to(field.<span class="tok-type">type</span>, to_config);</span>
<span class="line" id="L692">                    },</span>
<span class="line" id="L693">                    .Union =&gt; <span class="tok-kw">if</span> (self.sub_cmd != <span class="tok-null">null</span> <span class="tok-kw">and</span> mem.eql(<span class="tok-type">u8</span>, self.sub_cmd.?.name, arg_name)) {</span>
<span class="line" id="L694">                        <span class="tok-kw">return</span> <span class="tok-builtin">@unionInit</span>(ToT, field.name, <span class="tok-kw">try</span> self.sub_cmd.?.to(field.<span class="tok-type">type</span>, to_config));</span>
<span class="line" id="L695">                    },</span>
<span class="line" id="L696">                    .Optional =&gt; |f_opt| <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L697">                        <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L698">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, opt.name, arg_name)) {</span>
<span class="line" id="L699">                                <span class="tok-kw">if</span> (!opt.val.isSet() <span class="tok-kw">and</span> type_info == .Struct) {</span>
<span class="line" id="L700">                                    <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L701">                                    <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L702">                                        <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L703">                                    <span class="tok-kw">break</span>;</span>
<span class="line" id="L704">                                }</span>
<span class="line" id="L705">                                <span class="tok-comment">//const val_tag = if (f_opt.child == []const u8) &quot;string&quot; else @typeName(f_opt.child);</span>
</span>
<span class="line" id="L706">                                <span class="tok-comment">//if (type_info == .Union) return @unionInit(ToT, field.name, @field(opt.val.generic, val_tag).get() catch continue); </span>
</span>
<span class="line" id="L707">                                <span class="tok-comment">//@field(out, field.name) = try @field(opt.val.generic, val_tag).get();</span>
</span>
<span class="line" id="L708">                                <span class="tok-kw">if</span> (type_info == .Union) <span class="tok-kw">return</span> <span class="tok-builtin">@unionInit</span>(ToT, field.name, opt.val.getAs(f_opt.child) <span class="tok-kw">catch</span> <span class="tok-kw">continue</span>); </span>
<span class="line" id="L709">                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-kw">try</span> opt.val.getAs(f_opt.child);</span>
<span class="line" id="L710">                            }</span>
<span class="line" id="L711">                        }</span>
<span class="line" id="L712">                    },</span>
<span class="line" id="L713">                    .Bool, .Int, .Float, .Pointer =&gt; <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L714">                        <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L715">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, val.name(), arg_name)) {</span>
<span class="line" id="L716">                                <span class="tok-kw">if</span> (!val.isSet() <span class="tok-kw">and</span> val.argIdx() == val.maxArgs() <span class="tok-kw">and</span> type_info == .Struct) {</span>
<span class="line" id="L717">                                    <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L718">                                    <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L719">                                        <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L720">                                    <span class="tok-kw">break</span>;</span>
<span class="line" id="L721">                                }</span>
<span class="line" id="L722">                                <span class="tok-comment">//const val_tag = if (field.type == []const u8) &quot;string&quot; else @typeName(field.type);</span>
</span>
<span class="line" id="L723">                                <span class="tok-comment">//if (type_info == .Union) return @unionInit(ToT, field.name, @field(val.generic, val_tag).get() catch continue); </span>
</span>
<span class="line" id="L724">                                <span class="tok-comment">//@field(out, field.name) = try @field(val.generic, val_tag).get();</span>
</span>
<span class="line" id="L725">                                <span class="tok-kw">if</span> (type_info == .Union) <span class="tok-kw">return</span> <span class="tok-builtin">@unionInit</span>(ToT, field.name, val.getAs(field.<span class="tok-type">type</span>) <span class="tok-kw">catch</span> <span class="tok-kw">continue</span>); </span>
<span class="line" id="L726">                                <span class="tok-builtin">@field</span>(out, field.name) = val.getAs(field.<span class="tok-type">type</span>) <span class="tok-kw">catch</span> |err| setVal: {</span>
<span class="line" id="L727">                                    <span class="tok-kw">if</span> (!to_config.allow_incompatible) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.IncompatibleType;</span>
<span class="line" id="L728">                                    <span class="tok-kw">break</span> :setVal <span class="tok-kw">switch</span> (field_info) {</span>
<span class="line" id="L729">                                        .Bool =&gt; <span class="tok-null">false</span>,</span>
<span class="line" id="L730">                                        .Int, .Float, =&gt; <span class="tok-builtin">@as</span>(field.<span class="tok-type">type</span>, <span class="tok-number">0</span>),</span>
<span class="line" id="L731">                                        .Pointer =&gt; <span class="tok-str">&quot;&quot;</span>,    </span>
<span class="line" id="L732">                                        <span class="tok-kw">else</span> =&gt; <span class="tok-kw">return</span> err,</span>
<span class="line" id="L733">                                    };</span>
<span class="line" id="L734">                                };</span>
<span class="line" id="L735">                            }</span>
<span class="line" id="L736">                        } </span>
<span class="line" id="L737">                    },</span>
<span class="line" id="L738">                    .Array =&gt; |ary| {</span>
<span class="line" id="L739">                        <span class="tok-kw">const</span> ary_info = <span class="tok-builtin">@typeInfo</span>(ary.child);</span>
<span class="line" id="L740">                        <span class="tok-kw">switch</span> (ary_info) {</span>
<span class="line" id="L741">                            .Optional =&gt; |a_opt| <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L742">                                <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L743">                                    <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, opt.name, arg_name)) {</span>
<span class="line" id="L744">                                        <span class="tok-kw">if</span> (!opt.val.isSet() <span class="tok-kw">and</span> type_info == .Struct) {</span>
<span class="line" id="L745">                                            <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L746">                                            <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>)  </span>
<span class="line" id="L747">                                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L748">                                            <span class="tok-kw">break</span>;</span>
<span class="line" id="L749">                                        }</span>
<span class="line" id="L750">                                        <span class="tok-kw">const</span> val_tag = <span class="tok-kw">if</span> (a_opt.child == []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-str">&quot;string&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(a_opt.child);</span>
<span class="line" id="L751">                                        <span class="tok-kw">var</span> f_ary: field.<span class="tok-type">type</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L752">                                        <span class="tok-kw">const</span> f_ary_slice = f_ary[<span class="tok-number">0</span>..];</span>
<span class="line" id="L753">                                        <span class="tok-kw">for</span> (f_ary_slice, <span class="tok-number">0</span>..) |*elm, idx| elm.* = <span class="tok-builtin">@field</span>(opt.val.generic, val_tag)._set_args[idx];</span>
<span class="line" id="L754">                                        <span class="tok-kw">if</span> (type_info == .Union) <span class="tok-kw">return</span> <span class="tok-builtin">@unionInit</span>(ToT, field.name, f_ary); </span>
<span class="line" id="L755">                                        <span class="tok-builtin">@field</span>(out, field.name) = f_ary;</span>
<span class="line" id="L756">                                        <span class="tok-kw">break</span>;</span>
<span class="line" id="L757">                                    }</span>
<span class="line" id="L758">                                }</span>
<span class="line" id="L759">                            },</span>
<span class="line" id="L760">                            .Bool, .Int, .Float, .Pointer =&gt; <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L761">                                <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L762">                                    <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, val.name(), arg_name)) {</span>
<span class="line" id="L763">                                        <span class="tok-kw">if</span> (!val.isSet() <span class="tok-kw">and</span> val.argIdx() == val.maxArgs() <span class="tok-kw">and</span> type_info == .Struct) {</span>
<span class="line" id="L764">                                            <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L765">                                            <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L766">                                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L767">                                            <span class="tok-kw">break</span>;</span>
<span class="line" id="L768">                                        }</span>
<span class="line" id="L769">                                        <span class="tok-kw">const</span> val_tag = <span class="tok-kw">if</span> (ary.child == []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-str">&quot;string&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(ary.child);</span>
<span class="line" id="L770">                                        <span class="tok-kw">var</span> f_ary: field.<span class="tok-type">type</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L771">                                        <span class="tok-kw">const</span> f_ary_slice = f_ary[<span class="tok-number">0</span>..];</span>
<span class="line" id="L772">                                        <span class="tok-kw">for</span> (f_ary_slice, <span class="tok-number">0</span>..) |*elm, idx| elm.* = <span class="tok-builtin">@field</span>(val.generic, val_tag)._set_args[idx] <span class="tok-kw">orelse</span> elmVal: {</span>
<span class="line" id="L773">                                            <span class="tok-kw">break</span> :elmVal <span class="tok-kw">switch</span> (ary_info) {</span>
<span class="line" id="L774">                                                .Bool =&gt; <span class="tok-null">false</span>,</span>
<span class="line" id="L775">                                                .Int, .Float, =&gt; <span class="tok-builtin">@as</span>(ary.child, <span class="tok-number">0</span>),</span>
<span class="line" id="L776">                                                .Pointer =&gt; <span class="tok-str">&quot;&quot;</span>,    </span>
<span class="line" id="L777">                                                <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!to_config.allow_incompatible) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.IncompatibleType,</span>
<span class="line" id="L778">                                            };</span>
<span class="line" id="L779">                                        };</span>
<span class="line" id="L780">                                        <span class="tok-kw">if</span> (type_info == .Union) <span class="tok-kw">return</span> <span class="tok-builtin">@unionInit</span>(ToT, field.name, f_ary); </span>
<span class="line" id="L781">                                        <span class="tok-builtin">@field</span>(out, field.name) = f_ary;</span>
<span class="line" id="L782">                                        <span class="tok-kw">break</span>;</span>
<span class="line" id="L783">                                    }</span>
<span class="line" id="L784">                                } </span>
<span class="line" id="L785">                            },</span>
<span class="line" id="L786">                            <span class="tok-kw">else</span> =&gt; {</span>
<span class="line" id="L787">                                <span class="tok-kw">if</span> (!to_config.allow_incompatible) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.IncompatibleType;</span>
<span class="line" id="L788">                            },</span>
<span class="line" id="L789">                        }</span>
<span class="line" id="L790">                    },</span>
<span class="line" id="L791">                    <span class="tok-kw">else</span> =&gt; {</span>
<span class="line" id="L792">                        <span class="tok-kw">if</span> (!to_config.allow_incompatible) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.IncompatibleType;</span>
<span class="line" id="L793">                    },</span>
<span class="line" id="L794">                }</span>
<span class="line" id="L795">            }</span>
<span class="line" id="L796">            <span class="tok-kw">return</span> out;</span>
<span class="line" id="L797">        }</span>
<span class="line" id="L798"></span>
<span class="line" id="L799">        <span class="tok-comment">/// Call this Command as the provided Function (`call_fn`), returning the provided Return Type (`ReturnT`).</span></span>
<span class="line" id="L800">        <span class="tok-comment">/// If the Return Type is an Error Union, this method expects only the payload Type.</span></span>
<span class="line" id="L801">        <span class="tok-comment">/// If the Function has a `self` parameter it can be provided using (`fn_self`). </span></span>
<span class="line" id="L802">        <span class="tok-comment">/// This effectively wraps the `@call()` builtin function by using this Command's Values as the function parameters.</span></span>
<span class="line" id="L803">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">callAs</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), <span class="tok-kw">comptime</span> call_fn: <span class="tok-kw">anytype</span>, fn_self: <span class="tok-kw">anytype</span>, <span class="tok-kw">comptime</span> ReturnT: <span class="tok-type">type</span>) !ReturnT {</span>
<span class="line" id="L804">            <span class="tok-kw">const</span> fn_info = <span class="tok-builtin">@typeInfo</span>(<span class="tok-builtin">@TypeOf</span>(call_fn));</span>
<span class="line" id="L805">            <span class="tok-kw">const</span> fn_name = <span class="tok-builtin">@typeName</span>(<span class="tok-builtin">@TypeOf</span>(call_fn));</span>
<span class="line" id="L806">            <span class="tok-kw">if</span> (fn_info != .Fn) {</span>
<span class="line" id="L807">                log.err(<span class="tok-str">&quot;Expected a Function but received '{s}'.&quot;</span>, .{ fn_name });</span>
<span class="line" id="L808">                <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ExpectedFn;</span>
<span class="line" id="L809">            }</span>
<span class="line" id="L810">            <span class="tok-kw">if</span> (self.vals == <span class="tok-null">null</span> <span class="tok-kw">or</span> self.vals.?.len &lt; fn_info.Fn.params.len) {</span>
<span class="line" id="L811">                log.err(<span class="tok-str">&quot;The provided function requires {d} parameters but only {d} was/were provided.&quot;</span>, .{ </span>
<span class="line" id="L812">                    fn_info.Fn.params.len, </span>
<span class="line" id="L813">                    <span class="tok-kw">if</span> (self.vals == <span class="tok-null">null</span>) <span class="tok-number">0</span> <span class="tok-kw">else</span> self.vals.?.len });</span>
<span class="line" id="L814">                <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ExpectedMoreParameters;</span>
<span class="line" id="L815">            }</span>
<span class="line" id="L816">            <span class="tok-kw">if</span> (fn_info.Fn.return_type.? != ReturnT) checkErrorUnion: {</span>
<span class="line" id="L817">                <span class="tok-kw">const</span> return_info = <span class="tok-builtin">@typeInfo</span>(fn_info.Fn.return_type.?);</span>
<span class="line" id="L818">                <span class="tok-kw">if</span> (return_info == .ErrorUnion <span class="tok-kw">and</span> return_info.ErrorUnion.payload == ReturnT) <span class="tok-kw">break</span> :checkErrorUnion;</span>
<span class="line" id="L819">                log.err(<span class="tok-str">&quot;The return type of '{s}' does not match the provided return type '{s}'.&quot;</span>, .{ fn_name, <span class="tok-builtin">@typeName</span>(ReturnT) });</span>
<span class="line" id="L820">                <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ReturnTypeMismatch;</span>
<span class="line" id="L821">            }</span>
<span class="line" id="L822"></span>
<span class="line" id="L823">            <span class="tok-kw">const</span> params = valsToParams: { </span>
<span class="line" id="L824">                <span class="tok-kw">const</span> param_types = <span class="tok-kw">comptime</span> paramTypes: {</span>
<span class="line" id="L825">                    <span class="tok-kw">var</span> types: [fn_info.Fn.params.len]<span class="tok-type">type</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L826">                    <span class="tok-kw">for</span> (types[<span class="tok-number">0</span>..], fn_info.Fn.params) |*T, param| T.* = param.<span class="tok-type">type</span>.?;</span>
<span class="line" id="L827">                    <span class="tok-kw">break</span> :paramTypes types;</span>
<span class="line" id="L828">                };</span>
<span class="line" id="L829">                <span class="tok-kw">var</span> params_tuple: meta.Tuple(param_types[<span class="tok-number">0</span>..]) = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L830">                <span class="tok-kw">const</span> start_idx = <span class="tok-kw">if</span> (<span class="tok-builtin">@TypeOf</span>(fn_self) == param_types[<span class="tok-number">0</span>]) <span class="tok-number">1</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L831">                <span class="tok-kw">if</span> (start_idx == <span class="tok-number">1</span>) params_tuple[<span class="tok-number">0</span>] = fn_self;</span>
<span class="line" id="L832">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (self.vals.?, &amp;params_tuple, <span class="tok-number">0</span>..) |val, *param, idx| {</span>
<span class="line" id="L833">                    <span class="tok-kw">if</span> (idx &lt; start_idx) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L834">                    param.* = <span class="tok-kw">try</span> val.getAs(<span class="tok-builtin">@TypeOf</span>(param.*)); </span>
<span class="line" id="L835">                }</span>
<span class="line" id="L836">                </span>
<span class="line" id="L837">                <span class="tok-kw">break</span> :valsToParams params_tuple;</span>
<span class="line" id="L838">            };</span>
<span class="line" id="L839"></span>
<span class="line" id="L840">            <span class="tok-kw">return</span> <span class="tok-builtin">@call</span>(.auto, call_fn, params); </span>
<span class="line" id="L841">        }</span>
<span class="line" id="L842"></span>
<span class="line" id="L843">        <span class="tok-comment">/// Create Sub Commands Enum.</span></span>
<span class="line" id="L844">        <span class="tok-comment">/// This is useful for switching on the Sub Commands of this Command during analysis, but the Command (`self`) must be comptime-known.</span></span>
<span class="line" id="L845">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">SubCommandsEnum</span>(<span class="tok-kw">comptime</span> self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) ?<span class="tok-type">type</span> {</span>
<span class="line" id="L846">            <span class="tok-kw">if</span> (self.sub_cmds == <span class="tok-null">null</span>) <span class="tok-kw">return</span> <span class="tok-null">null</span>; <span class="tok-comment">//@compileError(&quot;Could not create Sub Commands Enum. This Command has no Sub Commands.&quot;);</span>
</span>
<span class="line" id="L847">            <span class="tok-kw">var</span> cmd_fields: [self.sub_cmds.?.len]builtin.Type.EnumField = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L848">            <span class="tok-kw">for</span> (self.sub_cmds.?, cmd_fields[<span class="tok-number">0</span>..], <span class="tok-number">0</span>..) |cmd, *field, idx| {</span>
<span class="line" id="L849">                field.* = .{</span>
<span class="line" id="L850">                    .name = cmd.name,</span>
<span class="line" id="L851">                    .value = idx,</span>
<span class="line" id="L852">                };</span>
<span class="line" id="L853">            }</span>
<span class="line" id="L854">            <span class="tok-kw">return</span> <span class="tok-builtin">@Type</span>(builtin.Type{</span>
<span class="line" id="L855">                .Enum = .{</span>
<span class="line" id="L856">                    .tag_type = <span class="tok-type">u8</span>,</span>
<span class="line" id="L857">                    .fields = cmd_fields[<span class="tok-number">0</span>..],</span>
<span class="line" id="L858">                    .decls = &amp;.{},</span>
<span class="line" id="L859">                    .is_exhaustive = <span class="tok-null">true</span>,</span>
<span class="line" id="L860">                }</span>
<span class="line" id="L861">            });</span>
<span class="line" id="L862">        }</span>
<span class="line" id="L863"></span>
<span class="line" id="L864">        <span class="tok-comment">/// Config for the Validation of this Command.</span></span>
<span class="line" id="L865">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> ValidateConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L866">            <span class="tok-comment">// Check for Usage/Help Commands</span>
</span>
<span class="line" id="L867">            check_help_cmds: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L868">            <span class="tok-comment">// Check for Usage/Help Options</span>
</span>
<span class="line" id="L869">            check_help_opts: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L870">        };</span>
<span class="line" id="L871"></span>
<span class="line" id="L872">        <span class="tok-comment">/// Validate this Command during Comptime for distinct Sub Commands, Options, and Values using the provided ValidateConfig (`valid_config`). </span></span>
<span class="line" id="L873">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">validate</span>(<span class="tok-kw">comptime</span> self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), <span class="tok-kw">comptime</span> valid_config: ValidateConfig) <span class="tok-type">void</span> {</span>
<span class="line" id="L874">            <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L875">                <span class="tok-builtin">@setEvalBranchQuota</span>(<span class="tok-number">100_000</span>);</span>
<span class="line" id="L876">                <span class="tok-kw">const</span> usage_help_strs = .{ <span class="tok-str">&quot;usage&quot;</span>, <span class="tok-str">&quot;help&quot;</span> } ++ (.{ <span class="tok-str">&quot;&quot;</span> } ** (max_args - <span class="tok-number">2</span>));</span>
<span class="line" id="L877">                <span class="tok-comment">// Check for distinct Sub Commands and Validate them.</span>
</span>
<span class="line" id="L878">                <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L879">                    <span class="tok-kw">const</span> idx_offset: <span class="tok-type">u2</span> = <span class="tok-kw">if</span> (valid_config.check_help_cmds) <span class="tok-number">2</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L880">                    <span class="tok-kw">const</span> cmds = self.sub_cmds.?;</span>
<span class="line" id="L881">                    <span class="tok-kw">var</span> distinct_cmd: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> =</span>
<span class="line" id="L882">                        <span class="tok-kw">if</span> (!valid_config.check_help_cmds) .{ <span class="tok-str">&quot;&quot;</span> } ** max_args</span>
<span class="line" id="L883">                        <span class="tok-kw">else</span> usage_help_strs; </span>
<span class="line" id="L884">                    <span class="tok-kw">for</span> (cmds, <span class="tok-number">0</span>..) |cmd, idx| {</span>
<span class="line" id="L885">                        <span class="tok-kw">if</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_cmd[<span class="tok-number">0</span>..idx], cmd.name) != <span class="tok-null">null</span>) </span>
<span class="line" id="L886">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Sub Command '&quot;</span> ++ cmd.name ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L887">                        <span class="tok-comment">//cmd.validate();</span>
</span>
<span class="line" id="L888">                        distinct_cmd[idx + idx_offset] = cmd.name;</span>
<span class="line" id="L889">                    }</span>
<span class="line" id="L890">                }</span>
<span class="line" id="L891"></span>
<span class="line" id="L892">                <span class="tok-comment">// Check for distinct Options.</span>
</span>
<span class="line" id="L893">                <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L894">                    <span class="tok-kw">const</span> idx_offset: <span class="tok-type">u2</span> = <span class="tok-kw">if</span> (valid_config.check_help_cmds) <span class="tok-number">2</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L895">                    <span class="tok-kw">const</span> opts = self.opts.?;</span>
<span class="line" id="L896">                    <span class="tok-kw">var</span> distinct_name: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = </span>
<span class="line" id="L897">                        <span class="tok-kw">if</span> (!valid_config.check_help_opts) .{ <span class="tok-str">&quot;&quot;</span> } ** max_args</span>
<span class="line" id="L898">                        <span class="tok-kw">else</span> usage_help_strs; </span>
<span class="line" id="L899">                    <span class="tok-kw">var</span> distinct_short: [max_args]<span class="tok-type">u8</span> = </span>
<span class="line" id="L900">                        <span class="tok-kw">if</span> (!valid_config.check_help_opts) .{ <span class="tok-str">' '</span> } ** max_args</span>
<span class="line" id="L901">                        <span class="tok-kw">else</span> .{ <span class="tok-str">'u'</span>, <span class="tok-str">'h'</span> } ++ (.{ <span class="tok-str">' '</span> } ** (max_args - <span class="tok-number">2</span>));</span>
<span class="line" id="L902">                    <span class="tok-kw">var</span> distinct_long: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = </span>
<span class="line" id="L903">                        <span class="tok-kw">if</span> (!valid_config.check_help_opts) .{ <span class="tok-str">&quot;&quot;</span> } ** max_args</span>
<span class="line" id="L904">                        <span class="tok-kw">else</span> usage_help_strs; </span>
<span class="line" id="L905">                    <span class="tok-kw">for</span> (opts, <span class="tok-number">0</span>..) |opt, idx| {</span>
<span class="line" id="L906">                        <span class="tok-kw">if</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_name[<span class="tok-number">0</span>..], opt.name) != <span class="tok-null">null</span>) </span>
<span class="line" id="L907">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Option '&quot;</span> ++ opt.name ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L908">                        distinct_name[idx + idx_offset] = opt.name;</span>
<span class="line" id="L909">                        <span class="tok-kw">if</span> (opt.short_name != <span class="tok-null">null</span> <span class="tok-kw">and</span> indexOfEql(<span class="tok-type">u8</span>, distinct_short[<span class="tok-number">0</span>..], opt.short_name.?) != <span class="tok-null">null</span>) </span>
<span class="line" id="L910">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Option Short Name '&quot;</span> ++ .{ opt.short_name.? } ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L911">                        distinct_short[idx + idx_offset] = opt.short_name <span class="tok-kw">orelse</span> <span class="tok-str">' '</span>;</span>
<span class="line" id="L912">                        <span class="tok-kw">if</span> (opt.long_name != <span class="tok-null">null</span> <span class="tok-kw">and</span> indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_long[<span class="tok-number">0</span>..], opt.long_name.?) != <span class="tok-null">null</span>) </span>
<span class="line" id="L913">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Option Long Name '&quot;</span> ++ opt.long_name.? ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L914">                        distinct_long[idx + idx_offset] = opt.long_name <span class="tok-kw">orelse</span> <span class="tok-str">&quot;a!garbage@long#name$&quot;</span>;</span>
<span class="line" id="L915">                    }</span>
<span class="line" id="L916">                }</span>
<span class="line" id="L917"></span>
<span class="line" id="L918">                <span class="tok-comment">// Check for distinct Values.</span>
</span>
<span class="line" id="L919">                <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L920">                    <span class="tok-kw">const</span> vals = self.vals.?;</span>
<span class="line" id="L921">                    <span class="tok-kw">var</span> distinct_val: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = .{ <span class="tok-str">&quot;&quot;</span> } ** max_args;</span>
<span class="line" id="L922">                    <span class="tok-kw">for</span> (vals, <span class="tok-number">0</span>..) |val, idx| {</span>
<span class="line" id="L923">                        <span class="tok-kw">if</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_val[<span class="tok-number">0</span>..], val.name()) != <span class="tok-null">null</span>) </span>
<span class="line" id="L924">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Value '&quot;</span> ++ val.name ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L925">                        distinct_val[idx] = val.name();</span>
<span class="line" id="L926">                    }</span>
<span class="line" id="L927">                }</span>
<span class="line" id="L928">            }</span>
<span class="line" id="L929">        }</span>
<span class="line" id="L930"></span>
<span class="line" id="L931">        <span class="tok-comment">/// Config for the Initialization of this Command.</span></span>
<span class="line" id="L932">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> InitConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L933">            <span class="tok-comment">/// Validate this Command.</span></span>
<span class="line" id="L934">            validate_cmd: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L935">            <span class="tok-comment">/// Add Usage/Help message Commands to this Command.</span></span>
<span class="line" id="L936">            add_help_cmds: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L937">            <span class="tok-comment">/// Add Usage/Help message Options to this Command.</span></span>
<span class="line" id="L938">            add_help_opts: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L939">            <span class="tok-comment">/// Initialize this Command's Sub Commands.</span></span>
<span class="line" id="L940">            init_subcmds: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L941">        };</span>
<span class="line" id="L942"></span>
<span class="line" id="L943">        <span class="tok-comment">/// Initialize this Command with the provided InitConfig (`init_config`) by duplicating it with the provided Allocator (`alloc`) for Runtime use.</span></span>
<span class="line" id="L944">        <span class="tok-comment">/// This should be used after this Command has been created in Comptime. </span></span>
<span class="line" id="L945">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">init</span>(<span class="tok-kw">comptime</span> self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), alloc: mem.Allocator, <span class="tok-kw">comptime</span> init_config: InitConfig) !<span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L946">            <span class="tok-kw">if</span> (init_config.validate_cmd) self.validate(.{ </span>
<span class="line" id="L947">                .check_help_cmds = init_config.add_help_cmds,</span>
<span class="line" id="L948">                .check_help_opts = init_config.add_help_opts,    </span>
<span class="line" id="L949">            });</span>
<span class="line" id="L950"></span>
<span class="line" id="L951">            <span class="tok-kw">var</span> init_cmd = (<span class="tok-kw">try</span> alloc.dupe(<span class="tok-builtin">@This</span>(), &amp;.{ self.* }))[<span class="tok-number">0</span>];</span>
<span class="line" id="L952"></span>
<span class="line" id="L953">            <span class="tok-kw">const</span> usage_description = <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;Show the '&quot;</span>, init_cmd.name, <span class="tok-str">&quot;' usage display.&quot;</span> });</span>
<span class="line" id="L954">            <span class="tok-kw">const</span> help_description = <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;Show the '&quot;</span>, init_cmd.name, <span class="tok-str">&quot;' help display.&quot;</span> });</span>
<span class="line" id="L955"></span>
<span class="line" id="L956">            <span class="tok-kw">if</span> (init_config.add_help_cmds <span class="tok-kw">and</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;help&quot;</span>, <span class="tok-str">&quot;usage&quot;</span> }, self.name) == <span class="tok-null">null</span>)) {</span>
<span class="line" id="L957">                <span class="tok-kw">const</span> help_sub_cmds = &amp;[<span class="tok-number">2</span>]<span class="tok-builtin">@This</span>(){</span>
<span class="line" id="L958">                    .{</span>
<span class="line" id="L959">                        .name = <span class="tok-str">&quot;usage&quot;</span>,</span>
<span class="line" id="L960">                        .help_prefix = init_cmd.name,</span>
<span class="line" id="L961">                        .description = usage_description,</span>
<span class="line" id="L962">                        ._is_init = <span class="tok-null">true</span>,</span>
<span class="line" id="L963">                        ._alloc = alloc,</span>
<span class="line" id="L964">                    },</span>
<span class="line" id="L965">                    .{</span>
<span class="line" id="L966">                        .name = <span class="tok-str">&quot;help&quot;</span>,</span>
<span class="line" id="L967">                        .help_prefix = init_cmd.name,</span>
<span class="line" id="L968">                        .description = help_description,</span>
<span class="line" id="L969">                        ._is_init = <span class="tok-null">true</span>,</span>
<span class="line" id="L970">                        ._alloc = alloc,</span>
<span class="line" id="L971">                    }</span>
<span class="line" id="L972">                };</span>
<span class="line" id="L973"></span>
<span class="line" id="L974">                init_cmd.sub_cmds = </span>
<span class="line" id="L975">                    <span class="tok-kw">if</span> (init_cmd.sub_cmds != <span class="tok-null">null</span>) <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-builtin">@This</span>(), &amp;.{ init_cmd.sub_cmds.?, help_sub_cmds[<span class="tok-number">0</span>..] })</span>
<span class="line" id="L976">                    <span class="tok-kw">else</span> <span class="tok-kw">try</span> alloc.dupe(<span class="tok-builtin">@This</span>(), help_sub_cmds[<span class="tok-number">0</span>..]);</span>
<span class="line" id="L977">            }</span>
<span class="line" id="L978"></span>
<span class="line" id="L979">            <span class="tok-kw">if</span> (init_config.init_subcmds <span class="tok-kw">and</span> self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L980">                <span class="tok-kw">const</span> sub_len = init_cmd.sub_cmds.?.len;</span>
<span class="line" id="L981">                <span class="tok-kw">var</span> init_subcmds = <span class="tok-kw">try</span> alloc.alloc(<span class="tok-builtin">@This</span>(), sub_len);</span>
<span class="line" id="L982">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (self.sub_cmds.?, <span class="tok-number">0</span>..) |cmd, idx| init_subcmds[idx] = <span class="tok-kw">try</span> cmd.init(alloc, init_config);</span>
<span class="line" id="L983">                <span class="tok-kw">if</span> (init_config.add_help_cmds <span class="tok-kw">and</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;help&quot;</span>, <span class="tok-str">&quot;usage&quot;</span> }, self.name) == <span class="tok-null">null</span>)) {</span>
<span class="line" id="L984">                    init_subcmds[sub_len - <span class="tok-number">2</span>] = init_cmd.sub_cmds.?[sub_len - <span class="tok-number">2</span>];</span>
<span class="line" id="L985">                    init_subcmds[sub_len - <span class="tok-number">1</span>] = init_cmd.sub_cmds.?[sub_len - <span class="tok-number">1</span>];</span>
<span class="line" id="L986">                }</span>
<span class="line" id="L987">                init_cmd.sub_cmds = init_subcmds;</span>
<span class="line" id="L988">            }</span>
<span class="line" id="L989"></span>
<span class="line" id="L990">            <span class="tok-kw">if</span> (init_config.add_help_opts) {</span>
<span class="line" id="L991">                <span class="tok-kw">const</span> help_opts = &amp;[<span class="tok-number">2</span>]OptionT{</span>
<span class="line" id="L992">                    .{</span>
<span class="line" id="L993">                        .name = <span class="tok-str">&quot;usage&quot;</span>,</span>
<span class="line" id="L994">                        .short_name = <span class="tok-str">'u'</span>,</span>
<span class="line" id="L995">                        .long_name = <span class="tok-str">&quot;usage&quot;</span>,</span>
<span class="line" id="L996">                        .description = usage_description,</span>
<span class="line" id="L997">                        .val = ValueT.ofType(<span class="tok-type">bool</span>, .{ .name = <span class="tok-str">&quot;usage_flag&quot;</span> }),</span>
<span class="line" id="L998">                    },</span>
<span class="line" id="L999">                    .{</span>
<span class="line" id="L1000">                        .name = <span class="tok-str">&quot;help&quot;</span>,</span>
<span class="line" id="L1001">                        .short_name = <span class="tok-str">'h'</span>,</span>
<span class="line" id="L1002">                        .long_name = <span class="tok-str">&quot;help&quot;</span>,</span>
<span class="line" id="L1003">                        .description = help_description,</span>
<span class="line" id="L1004">                        .val = ValueT.ofType(<span class="tok-type">bool</span>, .{ .name = <span class="tok-str">&quot;help_flag&quot;</span> }),</span>
<span class="line" id="L1005">                    },</span>
<span class="line" id="L1006">                };</span>
<span class="line" id="L1007"></span>
<span class="line" id="L1008">                init_cmd.opts = </span>
<span class="line" id="L1009">                    <span class="tok-kw">if</span> (init_cmd.opts != <span class="tok-null">null</span>) <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-builtin">@This</span>().OptionT, &amp;.{ init_cmd.opts.?, help_opts[<span class="tok-number">0</span>..] })</span>
<span class="line" id="L1010">                    <span class="tok-kw">else</span> <span class="tok-kw">try</span> alloc.dupe(OptionT, help_opts[<span class="tok-number">0</span>..]);</span>
<span class="line" id="L1011">            }</span>
<span class="line" id="L1012"></span>
<span class="line" id="L1013">            init_cmd._is_init = <span class="tok-null">true</span>;</span>
<span class="line" id="L1014">            init_cmd._alloc = alloc;</span>
<span class="line" id="L1015"></span>
<span class="line" id="L1016">            <span class="tok-kw">return</span> init_cmd; </span>
<span class="line" id="L1017">        }</span>
<span class="line" id="L1018"></span>
<span class="line" id="L1019">        <span class="tok-comment">/// De-initialize this Command with its original Allocator.</span></span>
<span class="line" id="L1020">        <span class="tok-comment">/// If this Command has not yet been initialized, this does nothing.</span></span>
<span class="line" id="L1021">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">deinit</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) <span class="tok-type">void</span> {</span>
<span class="line" id="L1022">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span>;</span>
<span class="line" id="L1023">            <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>)</span>
<span class="line" id="L1024">                <span class="tok-kw">for</span> (self.sub_cmds.?) |*cmd| cmd.deinit();</span>
<span class="line" id="L1025">            self._alloc.?.destroy(self);</span>
<span class="line" id="L1026">        }</span>
<span class="line" id="L1027">    };</span>
<span class="line" id="L1028">}</span>
<span class="line" id="L1029"></span>
<span class="line" id="L1030"></span>
</code></pre></body>
</html>