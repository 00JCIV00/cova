<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Command.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPNJREFUeNpi/P//PwMlgOXHUjly9E0G4hwgZmQiQZMqEK8H4v9QzUEgQSaoADK+zhH9iAGL+C0gDoAaNg9mGLoLfgA1awK9hS9gzgJxA9RQBmQDrgMxJzRMGKE4HYj/Ial5A8QmQLwCJoBsgBYW2+TR1ChDaWt4LOBxKsi/VUh8XiD+gq4IVyzwQAMJBoKwacZlAB8Qf0bi96IZhtOAe1D6LpqaEiz6rmEzQAeIzwGxCJpieFqApo/vQKyJboAaEBsAsSEupwI1MwKjGBTVHOhegMX5UajYRqiBjMgYmj400cVh0XgTiKdC0zhJgJHS7AwQYABm9EAdCKrEfAAAAABJRU5ErkJggg=="/>
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-comment">//! Container Argument for Sub Commands, Options, and Values.</span></span>
<span class="line" id="L2"><span class="tok-comment">//!</span></span>
<span class="line" id="L3"><span class="tok-comment">//! A Command may contain any mix of those Arguments or none at all if it's to be used as a standalone Command.</span></span>
<span class="line" id="L4"><span class="tok-comment">//!</span></span>
<span class="line" id="L5"><span class="tok-comment">//! End User Example:</span></span>
<span class="line" id="L6"><span class="tok-comment">//!</span></span>
<span class="line" id="L7"><span class="tok-comment">//! ```</span></span>
<span class="line" id="L8"><span class="tok-comment">//! # Standalone Command</span></span>
<span class="line" id="L9"><span class="tok-comment">//! myapp help</span></span>
<span class="line" id="L10"><span class="tok-comment">//!</span></span>
<span class="line" id="L11"><span class="tok-comment">//! # Command w/ Options and Values</span></span>
<span class="line" id="L12"><span class="tok-comment">//! myapp -d &quot;This Value belongs to the 'd' Option.&quot; --toggle &quot;This is a standalone Value.&quot;</span></span>
<span class="line" id="L13"><span class="tok-comment">//! </span></span>
<span class="line" id="L14"><span class="tok-comment">//! # Command w/ Sub Command</span></span>
<span class="line" id="L15"><span class="tok-comment">//! myapp --opt &quot;Option for 'myapp' Command.&quot; subcmd --subcmd_opt &quot;Option for 'subcmd' Sub Command.&quot;</span></span>
<span class="line" id="L16"><span class="tok-comment">//! ```</span></span>
<span class="line" id="L17"></span>
<span class="line" id="L18"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L19"><span class="tok-kw">const</span> ascii = std.ascii;</span>
<span class="line" id="L20"><span class="tok-kw">const</span> builtin = std.builtin;</span>
<span class="line" id="L21"><span class="tok-kw">const</span> log = std.log;</span>
<span class="line" id="L22"><span class="tok-kw">const</span> mem = std.mem;</span>
<span class="line" id="L23"><span class="tok-kw">const</span> meta = std.meta;</span>
<span class="line" id="L24"><span class="tok-kw">const</span> ComptimeStringMap = std.ComptimeStringMap;</span>
<span class="line" id="L25"><span class="tok-kw">const</span> StringHashMap = std.StringHashMap;</span>
<span class="line" id="L26"></span>
<span class="line" id="L27"><span class="tok-kw">const</span> toLower = ascii.toLower;</span>
<span class="line" id="L28"><span class="tok-kw">const</span> toUpper = ascii.toUpper;</span>
<span class="line" id="L29"></span>
<span class="line" id="L30"><span class="tok-kw">const</span> Option = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;Option.zig&quot;</span>);</span>
<span class="line" id="L31"><span class="tok-kw">const</span> Value = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;Value.zig&quot;</span>);</span>
<span class="line" id="L32"><span class="tok-kw">const</span> utils = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;utils.zig&quot;</span>);</span>
<span class="line" id="L33"><span class="tok-kw">const</span> indexOfEql = utils.indexOfEql;</span>
<span class="line" id="L34"></span>
<span class="line" id="L35"></span>
<span class="line" id="L36"><span class="tok-comment">/// Config for custom Command types. </span></span>
<span class="line" id="L37"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> Config = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L38">    <span class="tok-comment">/// Option Config for this Command type.</span></span>
<span class="line" id="L39">    opt_config: Option.Config = .{},</span>
<span class="line" id="L40"></span>
<span class="line" id="L41">    <span class="tok-comment">/// Sub Commands Help Format.</span></span>
<span class="line" id="L42">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L43">    <span class="tok-comment">/// 1. String (Command Name)</span></span>
<span class="line" id="L44">    <span class="tok-comment">/// 2. String (Command Description)</span></span>
<span class="line" id="L45">    subcmds_help_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;{s}: {s}&quot;</span>,</span>
<span class="line" id="L46">    <span class="tok-comment">/// Values Help Format.</span></span>
<span class="line" id="L47">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L48">    <span class="tok-comment">/// 1. String (Value Name)</span></span>
<span class="line" id="L49">    <span class="tok-comment">/// 2. String (Value Type)</span></span>
<span class="line" id="L50">    <span class="tok-comment">/// 3. String (Value Description)</span></span>
<span class="line" id="L51">    vals_help_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;{s} ({s}): {s}&quot;</span>,</span>
<span class="line" id="L52">    </span>
<span class="line" id="L53">    <span class="tok-comment">/// Sub Commands Usage Format.</span></span>
<span class="line" id="L54">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L55">    <span class="tok-comment">/// 1. String (Command Name)</span></span>
<span class="line" id="L56">    subcmds_usage_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> =<span class="tok-str">&quot;'{s}'&quot;</span>, </span>
<span class="line" id="L57">    <span class="tok-comment">/// Values Usage Format.</span></span>
<span class="line" id="L58">    <span class="tok-comment">/// Must support the following format types in this order:</span></span>
<span class="line" id="L59">    <span class="tok-comment">/// 1. String (Value Name)</span></span>
<span class="line" id="L60">    <span class="tok-comment">/// 2. String (Value Type)</span></span>
<span class="line" id="L61">    vals_usage_fmt: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;\&quot;{s} ({s})\&quot;&quot;</span>,</span>
<span class="line" id="L62"></span>
<span class="line" id="L63">    <span class="tok-comment">/// The Global Help Prefix for all instances of this Command type.</span></span>
<span class="line" id="L64">    <span class="tok-comment">/// This can be overwritten per instance using the `help_prefix` field. </span></span>
<span class="line" id="L65">    global_help_prefix: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L66"></span>
<span class="line" id="L67">    <span class="tok-comment">/// The Default Max Number of Arguments for Commands, Options, and Values individually.</span></span>
<span class="line" id="L68">    <span class="tok-comment">/// This is used in for both `init()` and `from()` but can be overwritten for the latter.</span></span>
<span class="line" id="L69">    max_args: <span class="tok-type">u8</span> = <span class="tok-number">100</span>, </span>
<span class="line" id="L70"></span>
<span class="line" id="L71">};</span>
<span class="line" id="L72"></span>
<span class="line" id="L73"><span class="tok-comment">/// Create a Command type with the Base (default) configuration.</span></span>
<span class="line" id="L74"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">Base</span>() <span class="tok-type">type</span> { <span class="tok-kw">return</span> Custom(.{}); }</span>
<span class="line" id="L75"></span>
<span class="line" id="L76"><span class="tok-comment">/// Create a Custom Command type from the provided Config (`config`).</span></span>
<span class="line" id="L77"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">Custom</span>(<span class="tok-kw">comptime</span> config: Config) <span class="tok-type">type</span> {</span>
<span class="line" id="L78">    <span class="tok-kw">return</span> <span class="tok-kw">struct</span> {</span>
<span class="line" id="L79">        <span class="tok-comment">/// The Custom Option type to be used by this Custom Command type.</span></span>
<span class="line" id="L80">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> OptionT = Option.Custom(config.opt_config);</span>
<span class="line" id="L81">        <span class="tok-comment">/// Sub Commands Help Format.</span></span>
<span class="line" id="L82">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L83">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> subcmds_help_fmt = config.subcmds_help_fmt;</span>
<span class="line" id="L84">        <span class="tok-comment">/// Values Help Format.</span></span>
<span class="line" id="L85">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L86">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> vals_help_fmt = config.vals_help_fmt;</span>
<span class="line" id="L87">        <span class="tok-comment">/// Sub Commands Usage Format.</span></span>
<span class="line" id="L88">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L89">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> subcmds_usage_fmt = config.subcmds_usage_fmt;</span>
<span class="line" id="L90">        <span class="tok-comment">/// Values Usage Format.</span></span>
<span class="line" id="L91">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L92">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> vals_usage_fmt = config.vals_usage_fmt;</span>
<span class="line" id="L93">        <span class="tok-comment">/// Global Help Prefix.</span></span>
<span class="line" id="L94">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L95">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> global_help_prefix = config.global_help_prefix;</span>
<span class="line" id="L96">        <span class="tok-comment">/// Max Args.</span></span>
<span class="line" id="L97">        <span class="tok-comment">/// Check (`Command.Config`) for details.</span></span>
<span class="line" id="L98">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> max_args = config.max_args;</span>
<span class="line" id="L99"></span>
<span class="line" id="L100">        <span class="tok-comment">/// Flag denoting if this Command has been initialized to memory using `init()`.</span></span>
<span class="line" id="L101">        <span class="tok-comment">///</span></span>
<span class="line" id="L102">        <span class="tok-comment">/// **Internal Use.**</span></span>
<span class="line" id="L103">        _is_init: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L104">        <span class="tok-comment">/// The Allocator for this Command.</span></span>
<span class="line" id="L105">        <span class="tok-comment">/// This is set using `init()`.</span></span>
<span class="line" id="L106">        <span class="tok-comment">///</span></span>
<span class="line" id="L107">        <span class="tok-comment">/// **Internal Use.**</span></span>
<span class="line" id="L108">        _alloc: ?mem.Allocator = <span class="tok-null">null</span>,</span>
<span class="line" id="L109"></span>
<span class="line" id="L110">        <span class="tok-comment">/// The list of Sub Commands this Command can take.</span></span>
<span class="line" id="L111">        sub_cmds: ?[]<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>() = <span class="tok-null">null</span>,</span>
<span class="line" id="L112">        <span class="tok-comment">/// The Sub Command assigned to this Command during Parsing, if any.</span></span>
<span class="line" id="L113">        <span class="tok-comment">///</span></span>
<span class="line" id="L114">        <span class="tok-comment">/// *This should be Read-Only for library users.*</span></span>
<span class="line" id="L115">        sub_cmd: ?*<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>() = <span class="tok-null">null</span>,</span>
<span class="line" id="L116">        <span class="tok-comment">/// The list of Options this Command can take.</span></span>
<span class="line" id="L117">        opts: ?[]<span class="tok-kw">const</span> OptionT = <span class="tok-null">null</span>,</span>
<span class="line" id="L118">        <span class="tok-comment">/// The list of Values this Command can take.</span></span>
<span class="line" id="L119">        vals: ?[]<span class="tok-kw">const</span> Value.Generic = <span class="tok-null">null</span>,</span>
<span class="line" id="L120"></span>
<span class="line" id="L121">        <span class="tok-comment">/// The Name of this Command for user identification and Usage/Help messages.</span></span>
<span class="line" id="L122">        name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L123">        <span class="tok-comment">/// The Prefix message used immediately before a Usage/Help message is displayed.</span></span>
<span class="line" id="L124">        help_prefix: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = global_help_prefix,</span>
<span class="line" id="L125">        <span class="tok-comment">/// The Description of this Command for Usage/Help messages.</span></span>
<span class="line" id="L126">        description: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L127"></span>
<span class="line" id="L128">        <span class="tok-comment">/// Sets the active Sub Command for this Command.</span></span>
<span class="line" id="L129">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setSubCmd</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), set_cmd: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) <span class="tok-type">void</span> {</span>
<span class="line" id="L130">            <span class="tok-builtin">@constCast</span>(self).*.sub_cmd = set_cmd;</span>
<span class="line" id="L131">        }</span>
<span class="line" id="L132"></span>
<span class="line" id="L133">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Options.</span></span>
<span class="line" id="L134">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getOpts</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) !StringHashMap(OptionT) {</span>
<span class="line" id="L135">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.CommandNotInitialized;</span>
<span class="line" id="L136">            <span class="tok-kw">return</span> getOptsAlloc(self._alloc.?);</span>
<span class="line" id="L137">        }</span>
<span class="line" id="L138">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Options using the provided Allocator (`alloc`).</span></span>
<span class="line" id="L139">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getOptsAlloc</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), alloc: mem.Allocator) !StringHashMap(OptionT) {</span>
<span class="line" id="L140">            <span class="tok-kw">if</span> (self.opts == <span class="tok-null">null</span>) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.NoOptionsInCommand;</span>
<span class="line" id="L141">            <span class="tok-kw">var</span> map = StringHashMap(OptionT).init(alloc);</span>
<span class="line" id="L142">            <span class="tok-kw">for</span> (self.opts.?) |opt| { <span class="tok-kw">try</span> map.put(opt.name, opt); }</span>
<span class="line" id="L143">            <span class="tok-kw">return</span> map;</span>
<span class="line" id="L144">        }</span>
<span class="line" id="L145"></span>
<span class="line" id="L146">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Values.</span></span>
<span class="line" id="L147">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getVals</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) !StringHashMap(Value) {</span>
<span class="line" id="L148">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.CommandNotInitialized;</span>
<span class="line" id="L149">            <span class="tok-kw">return</span> getValsAlloc(self._alloc.?);</span>
<span class="line" id="L150">        }</span>
<span class="line" id="L151">        <span class="tok-comment">/// Gets a StringHashMap of this Command's Values using the provided Allocator (`alloc`).</span></span>
<span class="line" id="L152">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getValsAlloc</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), alloc: mem.Allocator) !StringHashMap(Value) {</span>
<span class="line" id="L153">            <span class="tok-kw">if</span> (self.vals == <span class="tok-null">null</span>) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.NoValuesInCommand;</span>
<span class="line" id="L154">            <span class="tok-kw">var</span> map = StringHashMap(Value).init(alloc);</span>
<span class="line" id="L155">            <span class="tok-kw">for</span> (self.vals.?) |val| { <span class="tok-kw">try</span> map.put(val.name, val); }</span>
<span class="line" id="L156">            <span class="tok-kw">return</span> map;</span>
<span class="line" id="L157">        }</span>
<span class="line" id="L158"></span>
<span class="line" id="L159">        <span class="tok-comment">/// Creates the Help message for this Command and Writes it to the provided Writer (`writer`).</span></span>
<span class="line" id="L160">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">help</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), writer: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L161">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;{s}\n&quot;</span>, .{ self.help_prefix });</span>
<span class="line" id="L162"></span>
<span class="line" id="L163">            <span class="tok-kw">try</span> self.usage(writer);</span>
<span class="line" id="L164"></span>
<span class="line" id="L165">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">\\HELP:</span></span>

<span class="line" id="L166">                             <span class="tok-str">\\    COMMAND: {s}</span></span>

<span class="line" id="L167">                             <span class="tok-str">\\</span></span>

<span class="line" id="L168">                             <span class="tok-str">\\    DESCRIPTION: {s}</span></span>

<span class="line" id="L169">                             <span class="tok-str">\\</span></span>

<span class="line" id="L170">                             <span class="tok-str">\\</span></span>

<span class="line" id="L171">                             , .{ self.name, self.description });</span>
<span class="line" id="L172">            </span>
<span class="line" id="L173">            <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L174">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;    SUB COMMANDS:\n&quot;</span>, .{});</span>
<span class="line" id="L175">                <span class="tok-kw">for</span> (self.sub_cmds.?) |cmd| {</span>
<span class="line" id="L176">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;        &quot;</span>, .{});</span>
<span class="line" id="L177">                    <span class="tok-kw">try</span> writer.print(subcmds_help_fmt, .{cmd.name, cmd.description});</span>
<span class="line" id="L178">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L179">                }</span>
<span class="line" id="L180">            }</span>
<span class="line" id="L181">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L182"></span>
<span class="line" id="L183">            <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L184">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;    OPTIONS:\n&quot;</span>, .{});</span>
<span class="line" id="L185">                <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L186">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;        &quot;</span>, .{});</span>
<span class="line" id="L187">                    <span class="tok-kw">try</span> opt.help(writer);</span>
<span class="line" id="L188">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L189">                }</span>
<span class="line" id="L190">            }</span>
<span class="line" id="L191">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L192"></span>
<span class="line" id="L193">            <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L194">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;    VALUES:\n&quot;</span>, .{});</span>
<span class="line" id="L195">                <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L196">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;        &quot;</span>, .{});</span>
<span class="line" id="L197">                    <span class="tok-kw">try</span> writer.print(vals_help_fmt, .{ val.name(), val.valType(), val.description() });</span>
<span class="line" id="L198">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L199">                }</span>
<span class="line" id="L200">            }</span>
<span class="line" id="L201">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n&quot;</span>, .{});</span>
<span class="line" id="L202">        }</span>
<span class="line" id="L203"></span>
<span class="line" id="L204">        <span class="tok-comment">/// Creates the Usage message for this Command and Writes it to the provided Writer (`writer`).</span></span>
<span class="line" id="L205">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">usage</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), writer: <span class="tok-kw">anytype</span>) !<span class="tok-type">void</span> {</span>
<span class="line" id="L206">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;USAGE: {s} &quot;</span>, .{ self.name });</span>
<span class="line" id="L207">            <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L208">                <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L209">                    <span class="tok-kw">try</span> opt.usage(writer);</span>
<span class="line" id="L210">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot; &quot;</span>, .{});</span>
<span class="line" id="L211">                }</span>
<span class="line" id="L212">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;| &quot;</span>, .{});</span>
<span class="line" id="L213">            }</span>
<span class="line" id="L214">            <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L215">                <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L216">                    <span class="tok-kw">try</span> writer.print(vals_usage_fmt, .{ val.name(), val.valType() });</span>
<span class="line" id="L217">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot; &quot;</span>, .{});</span>
<span class="line" id="L218">                }</span>
<span class="line" id="L219">                <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;| &quot;</span>, .{});</span>
<span class="line" id="L220">            }</span>
<span class="line" id="L221">            <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L222">                <span class="tok-kw">for</span> (self.sub_cmds.?) |cmd| {</span>
<span class="line" id="L223">                    <span class="tok-kw">try</span> writer.print(subcmds_usage_fmt, .{ cmd.name });</span>
<span class="line" id="L224">                    <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot; &quot;</span>, .{});</span>
<span class="line" id="L225">                }</span>
<span class="line" id="L226">            } </span>
<span class="line" id="L227"></span>
<span class="line" id="L228">            <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;\n\n&quot;</span>, .{});</span>
<span class="line" id="L229">        }</span>
<span class="line" id="L230"></span>
<span class="line" id="L231">        <span class="tok-comment">/// Check if Usage or Help have been set and call their respective methods.</span></span>
<span class="line" id="L232">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">checkUsageHelp</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), writer: <span class="tok-kw">anytype</span>) !<span class="tok-type">bool</span> {</span>
<span class="line" id="L233">            <span class="tok-kw">if</span> (self.checkFlag(<span class="tok-str">&quot;usage&quot;</span>)) {</span>
<span class="line" id="L234">                <span class="tok-kw">try</span> self.usage(writer);</span>
<span class="line" id="L235">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L236">            }</span>
<span class="line" id="L237">            <span class="tok-kw">if</span> (self.checkFlag(<span class="tok-str">&quot;help&quot;</span>)) {</span>
<span class="line" id="L238">                <span class="tok-kw">try</span> self.help(writer);</span>
<span class="line" id="L239">                <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L240">            }</span>
<span class="line" id="L241">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L242">        }</span>
<span class="line" id="L243"></span>
<span class="line" id="L244">        <span class="tok-comment">/// Check if a Flag (`flag_name`) has been set on this Command as a Command, Option, or Value.</span></span>
<span class="line" id="L245">        <span class="tok-comment">/// This is particularly useful for checking if Help or Usage has been called.</span></span>
<span class="line" id="L246">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">checkFlag</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), flag_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L247">            <span class="tok-kw">return</span> (</span>
<span class="line" id="L248">                (self.sub_cmd != <span class="tok-null">null</span> <span class="tok-kw">and</span> mem.eql(<span class="tok-type">u8</span>, self.sub_cmd.?.name, flag_name)) <span class="tok-kw">or</span></span>
<span class="line" id="L249">                checkOpt: {</span>
<span class="line" id="L250">                    <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L251">                        <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L252">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, opt.name, flag_name) <span class="tok-kw">and</span> </span>
<span class="line" id="L253">                                mem.eql(<span class="tok-type">u8</span>, opt.val.valType(), <span class="tok-str">&quot;bool&quot;</span>) <span class="tok-kw">and</span> </span>
<span class="line" id="L254">                                opt.val.<span class="tok-type">bool</span>.get() <span class="tok-kw">catch</span> <span class="tok-null">false</span>)</span>
<span class="line" id="L255">                                    <span class="tok-kw">break</span> :checkOpt <span class="tok-null">true</span>;</span>
<span class="line" id="L256">                        }</span>
<span class="line" id="L257">                    }</span>
<span class="line" id="L258">                    <span class="tok-kw">break</span> :checkOpt <span class="tok-null">false</span>;</span>
<span class="line" id="L259">                } <span class="tok-kw">or</span></span>
<span class="line" id="L260">                checkVal: {</span>
<span class="line" id="L261">                    <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L262">                        <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L263">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, val.name(), flag_name) <span class="tok-kw">and</span></span>
<span class="line" id="L264">                                mem.eql(<span class="tok-type">u8</span>, val.valType(), <span class="tok-str">&quot;bool&quot;</span>) <span class="tok-kw">and</span></span>
<span class="line" id="L265">                                val.<span class="tok-type">bool</span>.get() <span class="tok-kw">catch</span> <span class="tok-null">false</span>)</span>
<span class="line" id="L266">                                    <span class="tok-kw">break</span> :checkVal <span class="tok-null">true</span>;</span>
<span class="line" id="L267">                        }</span>
<span class="line" id="L268">                    }</span>
<span class="line" id="L269">                    <span class="tok-kw">break</span> :checkVal <span class="tok-null">false</span>;</span>
<span class="line" id="L270">                }</span>
<span class="line" id="L271">            );</span>
<span class="line" id="L272">        }</span>
<span class="line" id="L273"></span>
<span class="line" id="L274">        <span class="tok-comment">/// Config for creating Commands from Structs using `from()`.</span></span>
<span class="line" id="L275">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> FromConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L276">            <span class="tok-comment">/// Ignore incompatible types.</span></span>
<span class="line" id="L277">            ignore_incompatible: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L278">            <span class="tok-comment">/// Attempt to create Short Options.</span></span>
<span class="line" id="L279">            <span class="tok-comment">/// This will attempt to make a short option name from the first letter of the field name in lowercase then uppercase, sequentially working through each next letter if the previous one has already been used. (Note, user must deconflict for 'u' and 'h' if using auto-generated Usage/Help Options.)</span></span>
<span class="line" id="L280">            attempt_short_opts: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L281">            <span class="tok-comment">/// A Name for the Command.</span></span>
<span class="line" id="L282">            <span class="tok-comment">/// A blank value will default to the type name of the Struct.</span></span>
<span class="line" id="L283">            cmd_name: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L284">            <span class="tok-comment">/// A Description for the Command.</span></span>
<span class="line" id="L285">            cmd_description: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L286">            <span class="tok-comment">/// A Help Prefix for the Command.</span></span>
<span class="line" id="L287">            cmd_help_prefix: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = global_help_prefix,</span>
<span class="line" id="L288"></span>
<span class="line" id="L289">            <span class="tok-comment">/// Descriptions of the Command's Arguments (Sub Commands, Options, and Values).</span></span>
<span class="line" id="L290">            <span class="tok-comment">/// These Descriptions will be used across this Command and all of its Sub Commands.</span></span>
<span class="line" id="L291">            <span class="tok-comment">///</span></span>
<span class="line" id="L292">            <span class="tok-comment">/// Format: `.{ &quot;argument_name&quot;, &quot;Description of the Argument.&quot; }`</span></span>
<span class="line" id="L293">            sub_descriptions: []<span class="tok-kw">const</span> <span class="tok-kw">struct</span> { []<span class="tok-kw">const</span> <span class="tok-type">u8</span>, []<span class="tok-kw">const</span> <span class="tok-type">u8</span> } = &amp;.{ .{ <span class="tok-str">&quot;__nosubdescriptionsprovided__&quot;</span>, <span class="tok-str">&quot;&quot;</span> } },</span>
<span class="line" id="L294"></span>
<span class="line" id="L295">            <span class="tok-comment">/// Max number of Sub Commands.</span></span>
<span class="line" id="L296">            max_cmds: <span class="tok-type">u8</span> = max_args,</span>
<span class="line" id="L297">            <span class="tok-comment">/// Max number of Options.</span></span>
<span class="line" id="L298">            max_opts: <span class="tok-type">u8</span> = max_args,</span>
<span class="line" id="L299">            <span class="tok-comment">/// Max number of Values.</span></span>
<span class="line" id="L300">            max_vals: <span class="tok-type">u8</span> = max_args,</span>
<span class="line" id="L301">        };</span>
<span class="line" id="L302"></span>
<span class="line" id="L303">        <span class="tok-comment">/// Create a Command from the provided Struct (`from_struct`).</span></span>
<span class="line" id="L304">        <span class="tok-comment">/// The provided Struct must be Comptime-known.</span></span>
<span class="line" id="L305">        <span class="tok-comment">///</span></span>
<span class="line" id="L306">        <span class="tok-comment">/// Types are converted as follows:</span></span>
<span class="line" id="L307">        <span class="tok-comment">/// - Structs = Commands</span></span>
<span class="line" id="L308">        <span class="tok-comment">/// - Valid Values = Single-Values (Valid Values can be found under `Value.zig/Generic`.)</span></span>
<span class="line" id="L309">        <span class="tok-comment">/// - Valid Optionals = Single-Options (Valid Optionals are nullable versions of Valid Values.)</span></span>
<span class="line" id="L310">        <span class="tok-comment">/// - Arrays of Valid Values = Multi-Values</span></span>
<span class="line" id="L311">        <span class="tok-comment">/// - Arrays of Valid Optionals = Multi-Options </span></span>
<span class="line" id="L312">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">from</span>(<span class="tok-kw">comptime</span> from_struct: <span class="tok-type">type</span>, <span class="tok-kw">comptime</span> from_config: FromConfig) <span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L313">            <span class="tok-kw">const</span> from_info = <span class="tok-builtin">@typeInfo</span>(from_struct);</span>
<span class="line" id="L314">            <span class="tok-kw">if</span> (from_info != .Struct) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;Provided Type is not a Struct.&quot;</span>);</span>
<span class="line" id="L315"></span>
<span class="line" id="L316">            <span class="tok-kw">var</span> from_cmds_buf: [from_config.max_cmds]<span class="tok-builtin">@This</span>() = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L317">            <span class="tok-kw">const</span> from_cmds = from_cmds_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L318">            <span class="tok-kw">var</span> cmds_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L319">            <span class="tok-kw">var</span> from_opts_buf: [from_config.max_opts]OptionT = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L320">            <span class="tok-kw">const</span> from_opts = from_opts_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L321">            <span class="tok-kw">var</span> opts_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L322">            <span class="tok-kw">var</span> short_names_buf: [from_config.max_opts]<span class="tok-type">u8</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L323">            <span class="tok-kw">const</span> short_names = short_names_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L324">            <span class="tok-kw">var</span> short_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L325">            <span class="tok-kw">var</span> from_vals_buf: [from_config.max_vals]Value.Generic = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L326">            <span class="tok-kw">const</span> from_vals = from_vals_buf[<span class="tok-number">0</span>..];</span>
<span class="line" id="L327">            <span class="tok-kw">var</span> vals_idx: <span class="tok-type">u8</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L328"></span>
<span class="line" id="L329">            <span class="tok-kw">const</span> arg_descriptions = ComptimeStringMap([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, from_config.sub_descriptions);</span>
<span class="line" id="L330"></span>
<span class="line" id="L331">            <span class="tok-kw">const</span> fields = meta.fields(from_struct);</span>
<span class="line" id="L332">            <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (fields) |field| {</span>
<span class="line" id="L333">                <span class="tok-kw">const</span> arg_description = arg_descriptions.get(field.name);</span>
<span class="line" id="L334">                <span class="tok-comment">// Handle Argument types.</span>
</span>
<span class="line" id="L335">                <span class="tok-kw">switch</span> (field.<span class="tok-type">type</span>) {</span>
<span class="line" id="L336">                    <span class="tok-builtin">@This</span>() =&gt; {</span>
<span class="line" id="L337">                        <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) {</span>
<span class="line" id="L338">                            from_cmds[cmds_idx] = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L339">                            cmds_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L340">                            <span class="tok-kw">continue</span>;</span>
<span class="line" id="L341">                        }</span>
<span class="line" id="L342">                    },</span>
<span class="line" id="L343">                    OptionT =&gt; {</span>
<span class="line" id="L344">                        <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) {</span>
<span class="line" id="L345">                            from_opts[opts_idx] = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L346">                            opts_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L347">                            <span class="tok-kw">continue</span>;</span>
<span class="line" id="L348">                        }</span>
<span class="line" id="L349">                    },</span>
<span class="line" id="L350">                    Value.Generic =&gt; {</span>
<span class="line" id="L351">                        <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) {</span>
<span class="line" id="L352">                            from_vals[vals_idx] = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L353">                            vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L354">                            <span class="tok-kw">continue</span>;</span>
<span class="line" id="L355">                        }</span>
<span class="line" id="L356">                    },</span>
<span class="line" id="L357">                    <span class="tok-kw">inline</span> <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L358">                }</span>
<span class="line" id="L359"></span>
<span class="line" id="L360">                <span class="tok-kw">const</span> field_info = <span class="tok-builtin">@typeInfo</span>(field.<span class="tok-type">type</span>);</span>
<span class="line" id="L361">                <span class="tok-comment">// Handle non-Argument types.</span>
</span>
<span class="line" id="L362">                <span class="tok-kw">switch</span> (field_info) {</span>
<span class="line" id="L363">                    <span class="tok-comment">// Commands</span>
</span>
<span class="line" id="L364">                    .Struct =&gt; {</span>
<span class="line" id="L365">                        <span class="tok-kw">const</span> sub_config = <span class="tok-kw">comptime</span> subConfig: {</span>
<span class="line" id="L366">                            <span class="tok-kw">var</span> new_config = from_config;</span>
<span class="line" id="L367">                            new_config.cmd_name = field.name;</span>
<span class="line" id="L368">                            new_config.cmd_description = arg_description <span class="tok-kw">orelse</span> <span class="tok-str">&quot;The '&quot;</span> ++ field.name ++ <span class="tok-str">&quot;' Command.&quot;</span>;</span>
<span class="line" id="L369">                            <span class="tok-kw">break</span> :subConfig new_config;</span>
<span class="line" id="L370">                        };</span>
<span class="line" id="L371">                        from_cmds[cmds_idx] = from(field.<span class="tok-type">type</span>, sub_config);</span>
<span class="line" id="L372">                        cmds_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L373">                    },</span>
<span class="line" id="L374">                    <span class="tok-comment">// Options</span>
</span>
<span class="line" id="L375">                    .Optional =&gt; {</span>
<span class="line" id="L376">                        <span class="tok-kw">const</span> short_name = shortName: {</span>
<span class="line" id="L377">                            <span class="tok-kw">if</span> (!from_config.attempt_short_opts) <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L378">                            <span class="tok-kw">for</span> (field.name) |char| {</span>
<span class="line" id="L379">                                <span class="tok-kw">const</span> ul_chars: [<span class="tok-number">2</span>]<span class="tok-type">u8</span> = .{ toLower(char), toUpper(char) };</span>
<span class="line" id="L380">                                <span class="tok-kw">for</span> (ul_chars) |ul| {</span>
<span class="line" id="L381">                                    <span class="tok-kw">if</span> (short_idx &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> indexOfEql(<span class="tok-type">u8</span>, short_names[<span class="tok-number">0</span>..short_idx], ul) != <span class="tok-null">null</span>) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L382">                                    short_names[short_idx] = ul;</span>
<span class="line" id="L383">                                    short_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L384">                                    <span class="tok-kw">break</span> :shortName ul;</span>
<span class="line" id="L385">                                }</span>
<span class="line" id="L386">                            }</span>
<span class="line" id="L387">                            <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L388">                        };</span>
<span class="line" id="L389">                        from_opts[opts_idx] = (OptionT.from(field, .{ </span>
<span class="line" id="L390">                            .short_name = short_name, </span>
<span class="line" id="L391">                            .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L392">                            .opt_description = arg_description</span>
<span class="line" id="L393">                        }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>);</span>
<span class="line" id="L394">                        opts_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L395">                    },</span>
<span class="line" id="L396">                    <span class="tok-comment">// Values</span>
</span>
<span class="line" id="L397">                    .Bool, .Int, .Float, .Pointer =&gt; {</span>
<span class="line" id="L398">                        from_vals[vals_idx] = (Value.from(field, .{</span>
<span class="line" id="L399">                            .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L400">                            .val_description = arg_description</span>
<span class="line" id="L401">                        }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>);</span>
<span class="line" id="L402">                        vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L403">                    },</span>
<span class="line" id="L404">                    <span class="tok-comment">// Multi</span>
</span>
<span class="line" id="L405">                    .Array =&gt; |ary| {</span>
<span class="line" id="L406">                        <span class="tok-kw">const</span> ary_info = <span class="tok-builtin">@typeInfo</span>(ary.child);</span>
<span class="line" id="L407">                        <span class="tok-kw">switch</span> (ary_info) {</span>
<span class="line" id="L408">                            .Optional =&gt; {</span>
<span class="line" id="L409">                                <span class="tok-kw">const</span> short_name = shortName: {</span>
<span class="line" id="L410">                                    <span class="tok-kw">if</span> (!from_config.attempt_short_opts) <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L411">                                    <span class="tok-kw">for</span> (field.name) |char| {</span>
<span class="line" id="L412">                                        <span class="tok-kw">const</span> ul_chars: [<span class="tok-number">2</span>]<span class="tok-type">u8</span> = .{ toLower(char), toUpper(char) };</span>
<span class="line" id="L413">                                        <span class="tok-kw">for</span> (ul_chars) |ul| {</span>
<span class="line" id="L414">                                            <span class="tok-kw">if</span> (short_idx &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> indexOfEql(<span class="tok-type">u8</span>, short_names[<span class="tok-number">0</span>..short_idx], ul) != <span class="tok-null">null</span>) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L415">                                            short_names[short_idx] = ul;</span>
<span class="line" id="L416">                                            short_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L417">                                            <span class="tok-kw">break</span> :shortName ul;</span>
<span class="line" id="L418">                                        }</span>
<span class="line" id="L419">                                    }</span>
<span class="line" id="L420">                                    <span class="tok-kw">break</span> :shortName <span class="tok-null">null</span>;</span>
<span class="line" id="L421">                                };</span>
<span class="line" id="L422">                                from_opts[opts_idx] = OptionT.from(field, .{</span>
<span class="line" id="L423">                                    .short_name = short_name, </span>
<span class="line" id="L424">                                    .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L425">                                    .opt_description = arg_description</span>
<span class="line" id="L426">                                }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>;</span>
<span class="line" id="L427">                                opts_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L428">                            },</span>
<span class="line" id="L429">                            .Bool, .Int, .Float, .Pointer =&gt; {</span>
<span class="line" id="L430">                                from_vals[vals_idx] = Value.from(field, .{</span>
<span class="line" id="L431">                                    .ignore_incompatible = from_config.ignore_incompatible,</span>
<span class="line" id="L432">                                    .val_description = arg_description</span>
<span class="line" id="L433">                                }) <span class="tok-kw">orelse</span> <span class="tok-kw">continue</span>;</span>
<span class="line" id="L434">                                vals_idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L435">                            },</span>
<span class="line" id="L436">                            <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!from_config.ignore_incompatible) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The field '&quot;</span> ++ field.name ++ <span class="tok-str">&quot;' of type 'Array' is incompatible. Arrays must contain one of the following types: Bool, Int, Float, Pointer (const u8), or their Optional counterparts.&quot;</span>),</span>
<span class="line" id="L437">                        }</span>
<span class="line" id="L438">                    },</span>
<span class="line" id="L439">                    <span class="tok-comment">// Incompatible</span>
</span>
<span class="line" id="L440">                    <span class="tok-kw">else</span> =&gt; <span class="tok-kw">if</span> (!from_config.ignore_incompatible) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The field '&quot;</span> ++ field.name ++ <span class="tok-str">&quot;' of type '&quot;</span> ++ <span class="tok-builtin">@typeName</span>(field.<span class="tok-type">type</span>) ++ <span class="tok-str">&quot;' is incompatible as it cannot be converted to a Command, Option, or Value.&quot;</span>),</span>
<span class="line" id="L441">                }</span>
<span class="line" id="L442">            }</span>
<span class="line" id="L443"></span>
<span class="line" id="L444">            <span class="tok-kw">return</span> <span class="tok-builtin">@This</span>(){</span>
<span class="line" id="L445">                .name = <span class="tok-kw">if</span> (from_config.cmd_name.len &gt; <span class="tok-number">0</span>) from_config.cmd_name <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(from_struct),</span>
<span class="line" id="L446">                .description = from_config.cmd_description,</span>
<span class="line" id="L447">                .help_prefix = from_config.cmd_help_prefix,</span>
<span class="line" id="L448">                .sub_cmds = <span class="tok-kw">if</span> (cmds_idx &gt; <span class="tok-number">0</span>) from_cmds[<span class="tok-number">0</span>..cmds_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L449">                .opts = <span class="tok-kw">if</span> (opts_idx &gt; <span class="tok-number">0</span>) from_opts[<span class="tok-number">0</span>..opts_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L450">                .vals = <span class="tok-kw">if</span> (vals_idx &gt; <span class="tok-number">0</span>) from_vals[<span class="tok-number">0</span>..vals_idx] <span class="tok-kw">else</span> <span class="tok-null">null</span>,</span>
<span class="line" id="L451">            };</span>
<span class="line" id="L452">        }</span>
<span class="line" id="L453"></span>
<span class="line" id="L454">        <span class="tok-comment">/// Config for creating Structs from Commands using `to()`.</span></span>
<span class="line" id="L455">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> ToConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L456">            <span class="tok-comment">/// Allow Unset Options and Values to be included.</span></span>
<span class="line" id="L457">            <span class="tok-comment">/// When this is active, an attempt will be made to use the Struct's default value (if available) in the event of an Unset Option/Value.</span></span>
<span class="line" id="L458">            allow_unset: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L459">            <span class="tok-comment">/// Ignore Incompatible types. Incompatible types are those that fall outside of the conversion rules listed under `from()`.</span></span>
<span class="line" id="L460">            <span class="tok-comment">/// When this is active, an attempt will be made to use the Struct's default value (if available) in the event of an Incompatible type.</span></span>
<span class="line" id="L461">            allow_incompatible: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L462">        };</span>
<span class="line" id="L463"></span>
<span class="line" id="L464">        <span class="tok-comment">/// Convert this Command to an instance of the provided Struct Type (`T`).</span></span>
<span class="line" id="L465">        <span class="tok-comment">/// This is the inverse of `from()`.</span></span>
<span class="line" id="L466">        <span class="tok-comment">///</span></span>
<span class="line" id="L467">        <span class="tok-comment">/// Types are converted as follows:</span></span>
<span class="line" id="L468">        <span class="tok-comment">/// - Commmands: Structs by recursively calling `to()`.</span></span>
<span class="line" id="L469">        <span class="tok-comment">/// - Single-Options: Optional versions of Values.</span></span>
<span class="line" id="L470">        <span class="tok-comment">/// - Single-Values: Booleans, Integers (Signed/Unsigned), and Pointers (`[]const u8`) only)</span></span>
<span class="line" id="L471">        <span class="tok-comment">/// - Multi-Options/Values: Arrays of the corresponding Optionals or Values.</span></span>
<span class="line" id="L472">        <span class="tok-comment">// TODO: Catch more error cases for incompatible types (i.e. Pointer not (`[]const u8`).</span>
</span>
<span class="line" id="L473">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">to</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), <span class="tok-kw">comptime</span> T: <span class="tok-type">type</span>, to_config: ToConfig) !T {</span>
<span class="line" id="L474">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.CommandNotInitialized;</span>
<span class="line" id="L475">            <span class="tok-kw">var</span> out: T = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L476">            <span class="tok-kw">const</span> fields = meta.fields(T);</span>
<span class="line" id="L477">            <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (fields) |field| {</span>
<span class="line" id="L478">                <span class="tok-kw">const</span> field_info = <span class="tok-builtin">@typeInfo</span>(field.<span class="tok-type">type</span>);</span>
<span class="line" id="L479">                <span class="tok-kw">switch</span> (field_info) {</span>
<span class="line" id="L480">                    .Struct =&gt; <span class="tok-kw">if</span> (self.sub_cmd != <span class="tok-null">null</span> <span class="tok-kw">and</span> mem.eql(<span class="tok-type">u8</span>, self.sub_cmd.?.name, field.name)) {</span>
<span class="line" id="L481">                        <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-kw">try</span> self.sub_cmd.?.to(field.<span class="tok-type">type</span>);</span>
<span class="line" id="L482">                    },</span>
<span class="line" id="L483">                    .Optional =&gt; |f_opt| <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L484">                        <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L485">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, opt.name, field.name)) {</span>
<span class="line" id="L486">                                <span class="tok-kw">if</span> (!opt.val.isSet()) {</span>
<span class="line" id="L487">                                    <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L488">                                    <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L489">                                        <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L490">                                    <span class="tok-kw">break</span>;</span>
<span class="line" id="L491">                                }</span>
<span class="line" id="L492">                                <span class="tok-kw">const</span> val_tag = <span class="tok-kw">if</span> (f_opt.child == []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-str">&quot;string&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(f_opt.child);</span>
<span class="line" id="L493">                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-kw">try</span> <span class="tok-builtin">@field</span>(opt.val, val_tag).get();</span>
<span class="line" id="L494">                            }</span>
<span class="line" id="L495">                        }</span>
<span class="line" id="L496">                    },</span>
<span class="line" id="L497">                    .Bool, .Int, .Float, .Pointer =&gt; <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L498">                        <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L499">                            <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, val.name(), field.name)) {</span>
<span class="line" id="L500">                                <span class="tok-kw">if</span> (!val.isSet() <span class="tok-kw">and</span> val.argIdx() == val.maxArgs()) {</span>
<span class="line" id="L501">                                    <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L502">                                    <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L503">                                        <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L504">                                    <span class="tok-kw">break</span>;</span>
<span class="line" id="L505">                                }</span>
<span class="line" id="L506">                                <span class="tok-kw">const</span> val_tag = <span class="tok-kw">if</span> (field.<span class="tok-type">type</span> == []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-str">&quot;string&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(field.<span class="tok-type">type</span>);</span>
<span class="line" id="L507">                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-kw">try</span> <span class="tok-builtin">@field</span>(val, val_tag).get();</span>
<span class="line" id="L508">                            }</span>
<span class="line" id="L509">                        } </span>
<span class="line" id="L510">                    },</span>
<span class="line" id="L511">                    .Array =&gt; |ary| {</span>
<span class="line" id="L512">                        <span class="tok-kw">const</span> ary_info = <span class="tok-builtin">@typeInfo</span>(ary.child);</span>
<span class="line" id="L513">                        <span class="tok-kw">switch</span> (ary_info) {</span>
<span class="line" id="L514">                            .Optional =&gt; |a_opt| <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L515">                                <span class="tok-kw">for</span> (self.opts.?) |opt| {</span>
<span class="line" id="L516">                                    <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, opt.name, field.name)) {</span>
<span class="line" id="L517">                                        <span class="tok-kw">if</span> (!opt.val.isSet()) {</span>
<span class="line" id="L518">                                            <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L519">                                            <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L520">                                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L521">                                            <span class="tok-kw">break</span>;</span>
<span class="line" id="L522">                                        }</span>
<span class="line" id="L523">                                        <span class="tok-kw">const</span> val_tag = <span class="tok-kw">if</span> (a_opt.child == []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-str">&quot;string&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(a_opt.child);</span>
<span class="line" id="L524">                                        <span class="tok-kw">var</span> f_ary: field.<span class="tok-type">type</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L525">                                        <span class="tok-kw">const</span> f_ary_slice = f_ary[<span class="tok-number">0</span>..];</span>
<span class="line" id="L526">                                        <span class="tok-kw">for</span> (f_ary_slice, <span class="tok-number">0</span>..) |*elm, idx| elm.* = <span class="tok-builtin">@field</span>(opt.val, val_tag)._set_args[idx];</span>
<span class="line" id="L527">                                        <span class="tok-builtin">@field</span>(out, field.name) = f_ary;</span>
<span class="line" id="L528">                                        <span class="tok-kw">break</span>;</span>
<span class="line" id="L529">                                    }</span>
<span class="line" id="L530">                                }</span>
<span class="line" id="L531">                            },</span>
<span class="line" id="L532">                            .Bool, .Int, .Float, .Pointer =&gt; <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L533">                                <span class="tok-kw">for</span> (self.vals.?) |val| {</span>
<span class="line" id="L534">                                    <span class="tok-kw">if</span> (mem.eql(<span class="tok-type">u8</span>, val.name(), field.name)) {</span>
<span class="line" id="L535">                                        <span class="tok-kw">if</span> (!val.isSet() <span class="tok-kw">and</span> val.argIdx() == val.maxArgs()) {</span>
<span class="line" id="L536">                                            <span class="tok-kw">if</span> (!to_config.allow_unset) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.ValueNotSet;</span>
<span class="line" id="L537">                                            <span class="tok-kw">if</span> (field.default_value != <span class="tok-null">null</span>) </span>
<span class="line" id="L538">                                                <span class="tok-builtin">@field</span>(out, field.name) = <span class="tok-builtin">@as</span>(*field.<span class="tok-type">type</span>, <span class="tok-builtin">@ptrCast</span>(<span class="tok-builtin">@alignCast</span>(<span class="tok-builtin">@constCast</span>(field.default_value)))).*;</span>
<span class="line" id="L539">                                            <span class="tok-kw">break</span>;</span>
<span class="line" id="L540">                                        }</span>
<span class="line" id="L541">                                        <span class="tok-kw">const</span> val_tag = <span class="tok-kw">if</span> (ary.child == []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-str">&quot;string&quot;</span> <span class="tok-kw">else</span> <span class="tok-builtin">@typeName</span>(ary.child);</span>
<span class="line" id="L542">                                        <span class="tok-kw">var</span> f_ary: field.<span class="tok-type">type</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L543">                                        <span class="tok-kw">const</span> f_ary_slice = f_ary[<span class="tok-number">0</span>..];</span>
<span class="line" id="L544">                                        <span class="tok-kw">for</span> (f_ary_slice, <span class="tok-number">0</span>..) |*elm, idx| elm.* = <span class="tok-builtin">@field</span>(val, val_tag)._set_args[idx];</span>
<span class="line" id="L545">                                        <span class="tok-builtin">@field</span>(out, field.name) = f_ary;</span>
<span class="line" id="L546">                                        <span class="tok-kw">break</span>;</span>
<span class="line" id="L547">                                    }</span>
<span class="line" id="L548">                                } </span>
<span class="line" id="L549">                            },</span>
<span class="line" id="L550">                            <span class="tok-kw">else</span> =&gt; {</span>
<span class="line" id="L551">                                <span class="tok-kw">if</span> (!to_config.allow_incompatible) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.IncompatibleType;</span>
<span class="line" id="L552">                            },</span>
<span class="line" id="L553">                        }</span>
<span class="line" id="L554">                    },</span>
<span class="line" id="L555">                    <span class="tok-kw">else</span> =&gt; {</span>
<span class="line" id="L556">                        <span class="tok-kw">if</span> (!to_config.allow_incompatible) <span class="tok-kw">return</span> <span class="tok-kw">error</span>.IncompatibleType;</span>
<span class="line" id="L557">                    },</span>
<span class="line" id="L558">                }</span>
<span class="line" id="L559">            }</span>
<span class="line" id="L560">            <span class="tok-kw">return</span> out;</span>
<span class="line" id="L561">        }</span>
<span class="line" id="L562"></span>
<span class="line" id="L563">        <span class="tok-comment">/// Create Sub Commands Enum.</span></span>
<span class="line" id="L564">        <span class="tok-comment">/// This is useful for switching on the Sub Commands of this Command during analysis, but the Command (`self`) must be comptime-known.</span></span>
<span class="line" id="L565">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">SubCommandsEnum</span>(<span class="tok-kw">comptime</span> self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) ?<span class="tok-type">type</span> {</span>
<span class="line" id="L566">            <span class="tok-kw">if</span> (self.sub_cmds == <span class="tok-null">null</span>) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;Could not create Sub Commands Enum. This Command has no Sub Commands.&quot;</span>);</span>
<span class="line" id="L567">            <span class="tok-kw">var</span> cmd_fields: [self.sub_cmds.?.len]builtin.Type.EnumField = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L568">            <span class="tok-kw">for</span> (self.sub_cmds.?, cmd_fields[<span class="tok-number">0</span>..], <span class="tok-number">0</span>..) |cmd, *field, idx| {</span>
<span class="line" id="L569">                field.* = .{</span>
<span class="line" id="L570">                    .name = cmd.name,</span>
<span class="line" id="L571">                    .value = idx,</span>
<span class="line" id="L572">                };</span>
<span class="line" id="L573">            }</span>
<span class="line" id="L574">            <span class="tok-kw">return</span> <span class="tok-builtin">@Type</span>(builtin.Type{</span>
<span class="line" id="L575">                .Enum = .{</span>
<span class="line" id="L576">                    .tag_type = <span class="tok-type">u8</span>,</span>
<span class="line" id="L577">                    .fields = cmd_fields[<span class="tok-number">0</span>..],</span>
<span class="line" id="L578">                    .decls = &amp;.{},</span>
<span class="line" id="L579">                    .is_exhaustive = <span class="tok-null">true</span>,</span>
<span class="line" id="L580">                }</span>
<span class="line" id="L581">            });</span>
<span class="line" id="L582">        }</span>
<span class="line" id="L583"></span>
<span class="line" id="L584">        <span class="tok-comment">/// Config for the Validation of this Command.</span></span>
<span class="line" id="L585">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> ValidateConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L586">            <span class="tok-comment">// Check for Usage/Help Commands</span>
</span>
<span class="line" id="L587">            check_help_cmds: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L588">            <span class="tok-comment">// Check for Usage/Help Options</span>
</span>
<span class="line" id="L589">            check_help_opts: <span class="tok-type">bool</span> = <span class="tok-null">false</span>,</span>
<span class="line" id="L590">        };</span>
<span class="line" id="L591"></span>
<span class="line" id="L592">        <span class="tok-comment">/// Validate this Command during Comptime for distinct Sub Commands, Options, and Values using the provided ValidateConfig (`valid_config`). </span></span>
<span class="line" id="L593">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">validate</span>(<span class="tok-kw">comptime</span> self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), <span class="tok-kw">comptime</span> valid_config: ValidateConfig) <span class="tok-type">void</span> {</span>
<span class="line" id="L594">            <span class="tok-kw">comptime</span> {</span>
<span class="line" id="L595">                <span class="tok-builtin">@setEvalBranchQuota</span>(<span class="tok-number">100_000</span>);</span>
<span class="line" id="L596">                <span class="tok-kw">const</span> usage_help_strs = .{ <span class="tok-str">&quot;usage&quot;</span>, <span class="tok-str">&quot;help&quot;</span> } ++ (.{ <span class="tok-str">&quot;&quot;</span> } ** (max_args - <span class="tok-number">2</span>));</span>
<span class="line" id="L597">                <span class="tok-comment">// Check for distinct Sub Commands and Validate them.</span>
</span>
<span class="line" id="L598">                <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L599">                    <span class="tok-kw">const</span> idx_offset: <span class="tok-type">u2</span> = <span class="tok-kw">if</span> (valid_config.check_help_cmds) <span class="tok-number">2</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L600">                    <span class="tok-kw">const</span> cmds = self.sub_cmds.?;</span>
<span class="line" id="L601">                    <span class="tok-kw">var</span> distinct_cmd: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> =</span>
<span class="line" id="L602">                        <span class="tok-kw">if</span> (!valid_config.check_help_cmds) .{ <span class="tok-str">&quot;&quot;</span> } ** max_args</span>
<span class="line" id="L603">                        <span class="tok-kw">else</span> usage_help_strs; </span>
<span class="line" id="L604">                    <span class="tok-kw">for</span> (cmds, <span class="tok-number">0</span>..) |cmd, idx| {</span>
<span class="line" id="L605">                        <span class="tok-kw">if</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_cmd[<span class="tok-number">0</span>..idx], cmd.name) != <span class="tok-null">null</span>) </span>
<span class="line" id="L606">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Sub Command '&quot;</span> ++ cmd.name ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L607">                        <span class="tok-comment">//cmd.validate();</span>
</span>
<span class="line" id="L608">                        distinct_cmd[idx + idx_offset] = cmd.name;</span>
<span class="line" id="L609">                    }</span>
<span class="line" id="L610">                }</span>
<span class="line" id="L611"></span>
<span class="line" id="L612">                <span class="tok-comment">// Check for distinct Options.</span>
</span>
<span class="line" id="L613">                <span class="tok-kw">if</span> (self.opts != <span class="tok-null">null</span>) {</span>
<span class="line" id="L614">                    <span class="tok-kw">const</span> idx_offset: <span class="tok-type">u2</span> = <span class="tok-kw">if</span> (valid_config.check_help_cmds) <span class="tok-number">2</span> <span class="tok-kw">else</span> <span class="tok-number">0</span>;</span>
<span class="line" id="L615">                    <span class="tok-kw">const</span> opts = self.opts.?;</span>
<span class="line" id="L616">                    <span class="tok-kw">var</span> distinct_name: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = </span>
<span class="line" id="L617">                        <span class="tok-kw">if</span> (!valid_config.check_help_opts) .{ <span class="tok-str">&quot;&quot;</span> } ** max_args</span>
<span class="line" id="L618">                        <span class="tok-kw">else</span> usage_help_strs; </span>
<span class="line" id="L619">                    <span class="tok-kw">var</span> distinct_short: [max_args]<span class="tok-type">u8</span> = </span>
<span class="line" id="L620">                        <span class="tok-kw">if</span> (!valid_config.check_help_opts) .{ <span class="tok-str">' '</span> } ** max_args</span>
<span class="line" id="L621">                        <span class="tok-kw">else</span> .{ <span class="tok-str">'u'</span>, <span class="tok-str">'h'</span> } ++ (.{ <span class="tok-str">' '</span> } ** (max_args - <span class="tok-number">2</span>));</span>
<span class="line" id="L622">                    <span class="tok-kw">var</span> distinct_long: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = </span>
<span class="line" id="L623">                        <span class="tok-kw">if</span> (!valid_config.check_help_opts) .{ <span class="tok-str">&quot;&quot;</span> } ** max_args</span>
<span class="line" id="L624">                        <span class="tok-kw">else</span> usage_help_strs; </span>
<span class="line" id="L625">                    <span class="tok-kw">for</span> (opts, <span class="tok-number">0</span>..) |opt, idx| {</span>
<span class="line" id="L626">                        <span class="tok-kw">if</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_name[<span class="tok-number">0</span>..], opt.name) != <span class="tok-null">null</span>) </span>
<span class="line" id="L627">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Option '&quot;</span> ++ opt.name ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L628">                        distinct_name[idx + idx_offset] = opt.name;</span>
<span class="line" id="L629">                        <span class="tok-kw">if</span> (opt.short_name != <span class="tok-null">null</span> <span class="tok-kw">and</span> indexOfEql(<span class="tok-type">u8</span>, distinct_short[<span class="tok-number">0</span>..], opt.short_name.?) != <span class="tok-null">null</span>) </span>
<span class="line" id="L630">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Option Short Name '&quot;</span> ++ .{ opt.short_name.? } ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L631">                        distinct_short[idx + idx_offset] = opt.short_name <span class="tok-kw">orelse</span> <span class="tok-str">' '</span>;</span>
<span class="line" id="L632">                        <span class="tok-kw">if</span> (opt.long_name != <span class="tok-null">null</span> <span class="tok-kw">and</span> indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_long[<span class="tok-number">0</span>..], opt.long_name.?) != <span class="tok-null">null</span>) </span>
<span class="line" id="L633">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Option Long Name '&quot;</span> ++ opt.long_name.? ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L634">                        distinct_long[idx + idx_offset] = opt.long_name <span class="tok-kw">orelse</span> <span class="tok-str">&quot;a!garbage@long#name$&quot;</span>;</span>
<span class="line" id="L635">                    }</span>
<span class="line" id="L636">                }</span>
<span class="line" id="L637"></span>
<span class="line" id="L638">                <span class="tok-comment">// Check for distinct Values.</span>
</span>
<span class="line" id="L639">                <span class="tok-kw">if</span> (self.vals != <span class="tok-null">null</span>) {</span>
<span class="line" id="L640">                    <span class="tok-kw">const</span> vals = self.vals.?;</span>
<span class="line" id="L641">                    <span class="tok-kw">var</span> distinct_val: [max_args][]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = .{ <span class="tok-str">&quot;&quot;</span> } ** max_args;</span>
<span class="line" id="L642">                    <span class="tok-kw">for</span> (vals, <span class="tok-number">0</span>..) |val, idx| {</span>
<span class="line" id="L643">                        <span class="tok-kw">if</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, distinct_val[<span class="tok-number">0</span>..], val.name()) != <span class="tok-null">null</span>) </span>
<span class="line" id="L644">                            <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;The Value '&quot;</span> ++ val.name ++ <span class="tok-str">&quot;' is set more than once.&quot;</span>);</span>
<span class="line" id="L645">                        distinct_val[idx] = val.name();</span>
<span class="line" id="L646">                    }</span>
<span class="line" id="L647">                }</span>
<span class="line" id="L648">            }</span>
<span class="line" id="L649">        }</span>
<span class="line" id="L650"></span>
<span class="line" id="L651">        <span class="tok-comment">/// Config for the Initialization of this Command.</span></span>
<span class="line" id="L652">        <span class="tok-kw">pub</span> <span class="tok-kw">const</span> InitConfig = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L653">            <span class="tok-comment">/// Validate this Command.</span></span>
<span class="line" id="L654">            validate_cmd: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L655">            <span class="tok-comment">/// Add Usage/Help message Commands to this Command.</span></span>
<span class="line" id="L656">            add_help_cmds: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L657">            <span class="tok-comment">/// Add Usage/Help message Options to this Command.</span></span>
<span class="line" id="L658">            add_help_opts: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L659">            <span class="tok-comment">/// Initialize this Command's Sub Commands.</span></span>
<span class="line" id="L660">            init_subcmds: <span class="tok-type">bool</span> = <span class="tok-null">true</span>,</span>
<span class="line" id="L661">        };</span>
<span class="line" id="L662"></span>
<span class="line" id="L663">        <span class="tok-comment">/// Initialize this Command with the provided InitConfig (`init_config`) by duplicating it with the provided Allocator (`alloc`) for Runtime use.</span></span>
<span class="line" id="L664">        <span class="tok-comment">/// This should be used after this Command has been created in Comptime. </span></span>
<span class="line" id="L665">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">init</span>(<span class="tok-kw">comptime</span> self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>(), alloc: mem.Allocator, <span class="tok-kw">comptime</span> init_config: InitConfig) !<span class="tok-builtin">@This</span>() {</span>
<span class="line" id="L666">            <span class="tok-kw">if</span> (init_config.validate_cmd) self.validate(.{ </span>
<span class="line" id="L667">                .check_help_cmds = init_config.add_help_cmds,</span>
<span class="line" id="L668">                .check_help_opts = init_config.add_help_opts,    </span>
<span class="line" id="L669">            });</span>
<span class="line" id="L670"></span>
<span class="line" id="L671">            <span class="tok-kw">var</span> init_cmd = (<span class="tok-kw">try</span> alloc.dupe(<span class="tok-builtin">@This</span>(), &amp;.{ self.* }))[<span class="tok-number">0</span>];</span>
<span class="line" id="L672"></span>
<span class="line" id="L673">            <span class="tok-kw">const</span> usage_description = <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;Show the '&quot;</span>, init_cmd.name, <span class="tok-str">&quot;' usage display.&quot;</span> });</span>
<span class="line" id="L674">            <span class="tok-kw">const</span> help_description = <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;Show the '&quot;</span>, init_cmd.name, <span class="tok-str">&quot;' help display.&quot;</span> });</span>
<span class="line" id="L675"></span>
<span class="line" id="L676">            <span class="tok-kw">if</span> (init_config.add_help_cmds <span class="tok-kw">and</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;help&quot;</span>, <span class="tok-str">&quot;usage&quot;</span> }, self.name) == <span class="tok-null">null</span>)) {</span>
<span class="line" id="L677">                <span class="tok-kw">const</span> help_sub_cmds = &amp;[<span class="tok-number">2</span>]<span class="tok-builtin">@This</span>(){</span>
<span class="line" id="L678">                    .{</span>
<span class="line" id="L679">                        .name = <span class="tok-str">&quot;usage&quot;</span>,</span>
<span class="line" id="L680">                        .help_prefix = init_cmd.name,</span>
<span class="line" id="L681">                        .description = usage_description,</span>
<span class="line" id="L682">                        ._is_init = <span class="tok-null">true</span>,</span>
<span class="line" id="L683">                        ._alloc = alloc,</span>
<span class="line" id="L684">                    },</span>
<span class="line" id="L685">                    .{</span>
<span class="line" id="L686">                        .name = <span class="tok-str">&quot;help&quot;</span>,</span>
<span class="line" id="L687">                        .help_prefix = init_cmd.name,</span>
<span class="line" id="L688">                        .description = help_description,</span>
<span class="line" id="L689">                        ._is_init = <span class="tok-null">true</span>,</span>
<span class="line" id="L690">                        ._alloc = alloc,</span>
<span class="line" id="L691">                    }</span>
<span class="line" id="L692">                };</span>
<span class="line" id="L693"></span>
<span class="line" id="L694">                init_cmd.sub_cmds = </span>
<span class="line" id="L695">                    <span class="tok-kw">if</span> (init_cmd.sub_cmds != <span class="tok-null">null</span>) <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-builtin">@This</span>(), &amp;.{ init_cmd.sub_cmds.?, help_sub_cmds[<span class="tok-number">0</span>..] })</span>
<span class="line" id="L696">                    <span class="tok-kw">else</span> <span class="tok-kw">try</span> alloc.dupe(<span class="tok-builtin">@This</span>(), help_sub_cmds[<span class="tok-number">0</span>..]);</span>
<span class="line" id="L697">            }</span>
<span class="line" id="L698"></span>
<span class="line" id="L699">            <span class="tok-kw">if</span> (init_config.init_subcmds <span class="tok-kw">and</span> self.sub_cmds != <span class="tok-null">null</span>) {</span>
<span class="line" id="L700">                <span class="tok-kw">const</span> sub_len = init_cmd.sub_cmds.?.len;</span>
<span class="line" id="L701">                <span class="tok-kw">var</span> init_subcmds = <span class="tok-kw">try</span> alloc.alloc(<span class="tok-builtin">@This</span>(), sub_len);</span>
<span class="line" id="L702">                <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (self.sub_cmds.?, <span class="tok-number">0</span>..) |cmd, idx| init_subcmds[idx] = <span class="tok-kw">try</span> cmd.init(alloc, init_config);</span>
<span class="line" id="L703">                <span class="tok-kw">if</span> (init_config.add_help_cmds <span class="tok-kw">and</span> (indexOfEql([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>, &amp;.{ <span class="tok-str">&quot;help&quot;</span>, <span class="tok-str">&quot;usage&quot;</span> }, self.name) == <span class="tok-null">null</span>)) {</span>
<span class="line" id="L704">                    init_subcmds[sub_len - <span class="tok-number">2</span>] = init_cmd.sub_cmds.?[sub_len - <span class="tok-number">2</span>];</span>
<span class="line" id="L705">                    init_subcmds[sub_len - <span class="tok-number">1</span>] = init_cmd.sub_cmds.?[sub_len - <span class="tok-number">1</span>];</span>
<span class="line" id="L706">                }</span>
<span class="line" id="L707">                init_cmd.sub_cmds = init_subcmds;</span>
<span class="line" id="L708">            }</span>
<span class="line" id="L709"></span>
<span class="line" id="L710">            <span class="tok-kw">if</span> (init_config.add_help_opts) {</span>
<span class="line" id="L711">                <span class="tok-kw">const</span> help_opts = &amp;[<span class="tok-number">2</span>]OptionT{</span>
<span class="line" id="L712">                    .{</span>
<span class="line" id="L713">                        .name = <span class="tok-str">&quot;usage&quot;</span>,</span>
<span class="line" id="L714">                        .short_name = <span class="tok-str">'u'</span>,</span>
<span class="line" id="L715">                        .long_name = <span class="tok-str">&quot;usage&quot;</span>,</span>
<span class="line" id="L716">                        .description = usage_description,</span>
<span class="line" id="L717">                        .val = Value.ofType(<span class="tok-type">bool</span>, .{ .name = <span class="tok-str">&quot;usage_flag&quot;</span> }),</span>
<span class="line" id="L718">                    },</span>
<span class="line" id="L719">                    .{</span>
<span class="line" id="L720">                        .name = <span class="tok-str">&quot;help&quot;</span>,</span>
<span class="line" id="L721">                        .short_name = <span class="tok-str">'h'</span>,</span>
<span class="line" id="L722">                        .long_name = <span class="tok-str">&quot;help&quot;</span>,</span>
<span class="line" id="L723">                        .description = help_description,</span>
<span class="line" id="L724">                        .val = Value.ofType(<span class="tok-type">bool</span>, .{ .name = <span class="tok-str">&quot;help_flag&quot;</span> }),</span>
<span class="line" id="L725">                    },</span>
<span class="line" id="L726">                };</span>
<span class="line" id="L727"></span>
<span class="line" id="L728">                init_cmd.opts = </span>
<span class="line" id="L729">                    <span class="tok-kw">if</span> (init_cmd.opts != <span class="tok-null">null</span>) <span class="tok-kw">try</span> mem.concat(alloc, <span class="tok-builtin">@This</span>().OptionT, &amp;.{ init_cmd.opts.?, help_opts[<span class="tok-number">0</span>..] })</span>
<span class="line" id="L730">                    <span class="tok-kw">else</span> <span class="tok-kw">try</span> alloc.dupe(OptionT, help_opts[<span class="tok-number">0</span>..]);</span>
<span class="line" id="L731">            }</span>
<span class="line" id="L732"></span>
<span class="line" id="L733">            init_cmd._is_init = <span class="tok-null">true</span>;</span>
<span class="line" id="L734">            init_cmd._alloc = alloc;</span>
<span class="line" id="L735"></span>
<span class="line" id="L736">            <span class="tok-kw">return</span> init_cmd; </span>
<span class="line" id="L737">        }</span>
<span class="line" id="L738"></span>
<span class="line" id="L739">        <span class="tok-comment">/// De-initialize this Command with its original Allocator.</span></span>
<span class="line" id="L740">        <span class="tok-comment">/// If this Command has not yet been initialized, this does nothing.</span></span>
<span class="line" id="L741">        <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">deinit</span>(self: *<span class="tok-kw">const</span> <span class="tok-builtin">@This</span>()) <span class="tok-type">void</span> {</span>
<span class="line" id="L742">            <span class="tok-kw">if</span> (!self._is_init) <span class="tok-kw">return</span>;</span>
<span class="line" id="L743">            <span class="tok-kw">if</span> (self.sub_cmds != <span class="tok-null">null</span>)</span>
<span class="line" id="L744">                <span class="tok-kw">for</span> (self.sub_cmds.?) |*cmd| cmd.deinit();</span>
<span class="line" id="L745">            self._alloc.?.destroy(self);</span>
<span class="line" id="L746">        }</span>
<span class="line" id="L747">    };</span>
<span class="line" id="L748">}</span>
<span class="line" id="L749"></span>
<span class="line" id="L750"></span>
</code></pre></body>
</html>